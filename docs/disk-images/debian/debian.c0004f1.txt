"""Weak reference support for Python.

This module is an implementation of PEP 205:

https://peps.python.org/pep-0205/
"""

# Naming convention: Variables named "wr" are weak reference objects;
# they are called this instead of "ref" to avoid name collisions with
# the module-global ref() function imported from _weakref.

from _weakref import (
     getweakrefcount,
     getweakrefs,
     ref,
     proxy,
     CallableProxyType,
     ProxyType,
     ReferenceType,
     _remove_dead_weakref)

from _weakrefset import WeakSet, _IterationGuard

import _collections_abc  # Import after _weakref to avoid circular import.
import sys
import itertools

ProxyTypes = (ProxyType, CallableProxyType)

__all__ = ["ref", "proxy", "getweakrefcount", "getweakrefs",
           "WeakKeyDictionary", "ReferenceType", "ProxyType",
           "CallableProxyType", "ProxyTypes", "WeakValueDictionary",
           "WeakSet", "WeakMethod", "finalize"]


_collections_abc.MutableSet.register(WeakSet)

class WeakMethod(ref):
    """
    A custom `weakref.ref` subclass which simulates a weak reference to
    a bound method, working around the lifetime problem of bound methods.
    """

    __slots__ = "_func_ref", "_meth_type", "_alive", "__weakref__"

    def __new__(cls, meth, callback=None):
        try:
            obj = meth.__self__
            func = meth.__func__
        except AttributeError:
            raise TypeError("argument should be a bound method, not {}"
                            .format(type(meth))) from None
        def _cb(arg):
            # The self-weakref trick is needed to avoid creating a reference
            # cycle.
            self = self_wr()
            if self._alive:
                self._alive = False
                if callback is not None:
                    callback(self)
        self = ref.__new__(cls, obj, _cb)
        self._func_ref = ref(func, _cb)
        self._meth_type = type(meth)
        self._alive = True
        self_wr = ref(self)
        return self

    def __call__(self):
        obj = super().__call__()
        func = self._func_ref()
        if obj is None or func is None:
            return None
        return self._meth_type(func, obj)

    def __eq__(self, other):
        if isinstance(other, WeakMethod):
            if not self._alive or not other._alive:
                return self is other
            return ref.__eq__(self, other) and self._func_ref == other._func_ref
        return NotImplemented

    def __ne__(self, other):
        if isinstance(other, WeakMethod):
            if not self._alive or not other._alive:
                return self is not other
            return ref.__ne__(self, other) or self._func_ref != other._func_ref
        return NotImplemented

    __hash__ = ref.__hash__


class WeakValueDictionary(_collections_abc.MutableMapping):
    """Mapping class that references values weakly.

    Entries in the dictionary will be discarded when no strong
    reference to the value exists anymore
    """
    # We inherit the constructor without worrying about the input
    # dictionary; since it uses our .update() method, we get the right
    # checks (if the other dictionary is a WeakValueDictionary,
    # objects are unwrapped on the way out, and we always wrap on the
    # way in).

    def __init__(self, other=(), /, **kw):
        def remove(wr, selfref=ref(self), _atomic_removal=_remove_dead_weakref):
            self = selfref()
            if self is not None:
                if self._iterating:
                    self._pending_removals.append(wr.key)
                else:
                    # Atomic removal is necessary since this function
                    # can be called asynchronously by the GC
                    _atomic_removal(self.data, wr.key)
        self._remove = remove
        # A list of keys to be removed
        self._pending_removals = []
        self._iterating = set()
        self.data = {}
        self.update(other, **kw)

    def _commit_removals(self, _atomic_removal=_remove_dead_weakref):
        pop = self._pending_removals.pop
        d = self.data
        # We shouldn't encounter any KeyError, because this method should
        # always be called *before* mutating the dict.
        while True:
            try:
                key = pop()
            except IndexError:
                return
            _atomic_removal(d, key)

    def __getitem__(self, key):
        if self._pending_removals:
            self._commit_removals()
        o = self.data[key]()
        if o is None:
            raise KeyError(key)
        else:
            return o

    def __delitem__(self, key):
        if self._pending_removals:
            self._commit_removals()
        del self.data[key]

    def __len__(self):
        if self._pending_removals:
            self._commit_removals()
        return len(self.data)

    def __contains__(self, key):
        if self._pending_removals:
            self._commit_removals()
        try:
            o = self.data[key]()
        except KeyError:
            return False
        return o is not None

    def __repr__(self):
        return "<%s at %#x>" % (self.__class__.__name__, id(self))

    def __setitem__(self, key, value):
        if self._pending_removals:
            self._commit_removals()
        self.data[key] = KeyedRef(value, self._remove, key)

    def copy(self):
        if self._pending_removals:
            self._commit_removals()
        new = WeakValueDictionary()
        with _IterationGuard(self):
            for key, wr in self.data.items():
                o = wr()
                if o is not None:
                    new[key] = o
        return new

    __copy__ = copy

    def __deepcopy__(self, memo):
        from copy import deepcopy
        if self._pending_removals:
            self._commit_removals()
        new = self.__class__()
        with _IterationGuard(self):
            for key, wr in self.data.items():
                o = wr()
                if o is not None:
                    new[deepcopy(key, memo)] = o
        return new

    def get(self, key, default=None):
        if self._pending_removals:
            self._commit_removals()
        try:
            wr = self.data[key]
        except KeyError:
            return default
        else:
            o = wr()
            if o is None:
                # This should only happen
                return default
            else:
                return o

    def items(self):
        if self._pending_removals:
            self._commit_removals()
        with _IterationGuard(self):
            for k, wr in self.data.items():
                v = wr()
                if v is not None:
                    yield k, v

    def keys(self):
        if self._pending_removals:
            self._commit_removals()
        with _IterationGuard(self):
            for k, wr in self.data.items():
                if wr() is not None:
                    yield k

    __iter__ = keys

    def itervaluerefs(self):
        """Return an iterator that yields the weak references to the values.

        The references are not guaranteed to be 'live' at the time
        they are used, so the result of calling the references needs
        to be checked before being used.  This can be used to avoid
        creating references that will cause the garbage collector to
        keep the values around longer than needed.

        """
        if self._pending_removals:
            self._commit_removals()
        with _IterationGuard(self):
            yield from self.data.values()

    def values(self):
        if self._pending_removals:
            self._commit_removals()
        with _IterationGuard(self):
            for wr in self.data.values():
                obj = wr()
                if obj is not None:
                    yield obj

    def popitem(self):
        if self._pending_removals:
            self._commit_removals()
        while True:
            key, wr = self.data.popitem()
            o = wr()
            if o is not None:
                return key, o

    def pop(self, key, *args):
        if self._pending_removals:
            self._commit_removals()
        try:
            o = self.data.pop(key)()
        except KeyError:
            o = None
        if o is None:
            if args:
                return args[0]
            else:
                raise KeyError(key)
        else:
            return o

    def setdefault(self, key, default=None):
        try:
            o = self.data[key]()
        except KeyError:
            o = None
        if o is None:
            if self._pending_removals:
                self._commit_removals()
            self.data[key] = KeyedRef(default, self._remove, key)
            return default
        else:
            return o

    def update(self, other=None, /, **kwargs):
        if self._pending_removals:
            self._commit_removals()
        d = self.data
        if other is not None:
            if not hasattr(other, "items"):
                other = dict(other)
            for key, o in other.items():
                d[key] = KeyedRef(o, self._remove, key)
        for key, o in kwargs.items():
            d[key] = KeyedRef(o, self._remove, key)

    def valuerefs(self):
        """Return a list of weak references to the values.

        The references are not guaranteed to be 'live' at the time
        they are used, so the result of calling the references needs
        to be checked before being used.  This can be used to avoid
        creating references that will cause the garbage collector to
        keep the values around longer than needed.

        """
        if self._pending_removals:
            self._commit_removals()
        return list(self.data.values())

    def __ior__(self, other):
        self.update(other)
        return self

    def __or__(self, other):
        if isinstance(other, _collections_abc.Mapping):
            c = self.copy()
            c.update(other)
            return c
        return NotImplemented

    def __ror__(self, other):
        if isinstance(other, _collections_abc.Mapping):
            c = self.__class__()
            c.update(other)
            c.update(self)
            return c
        return NotImplemented


class KeyedRef(ref):
    """Specialized reference that includes a key corresponding to the value.

    This is used in the WeakValueDictionary to avoid having to create
    a function object for each key stored in the mapping.  A shared
    callback object can use the 'key' attribute of a KeyedRef instead
    of getting a reference to the key from an enclosing scope.

    """

    __slots__ = "key",

    def __new__(type, ob, callback, key):
        self = ref.__new__(type, ob, callback)
        self.key = key
        return self

    def __init__(self, ob, callback, key):
        super().__init__(ob, callback)


class WeakKeyDictionary(_collections_abc.MutableMapping):
    """ Mapping class that references keys weakly.

    Entries in the dictionary will be discarded when there is no
    longer a strong reference to the key. This can be used to
    associate additional data with an object owned by other parts of
    an application without adding attributes to those objects. This
    can be especially useful with objects that override attribute
    accesses.
    """

    def __init__(self, dict=None):
        self.data = {}
        def remove(k, selfref=ref(self)):
            self = selfref()
            if self is not None:
                if self._iterating:
                    self._pending_removals.append(k)
                else:
                    try:
                        del self.data[k]
                    except KeyError:
                        pass
        self._remove = remove
        # A list of dead weakrefs (keys to be removed)
        self._pending_removals = []
        self._iterating = set()
        self._dirty_len = False
        if dict is not None:
            self.update(dict)

    def _commit_removals(self):
        # NOTE: We don't need to call this method before mutating the dict,
        # because a dead weakref never compares equal to a live weakref,
        # even if they happened to refer to equal objects.
        # However, it means keys may already have been removed.
        pop = self._pending_removals.pop
        d = self.data
        while True:
            try:
                key = pop()
            except IndexError:
                return

            try:
                del d[key]
            except KeyError:
                pass

    def _scrub_removals(self):
        d = self.data
        self._pending_removals = [k for k in self._pending_removals if k in d]
        self._dirty_len = False

    def __delitem__(self, key):
        self._dirty_len = True
        del self.data[ref(key)]

    def __getitem__(self, key):
        return self.data[ref(key)]

    def __len__(self):
        if self._dirty_len and self._pending_removals:
            # self._pending_removals may still contain keys which were
            # explicitly removed, we have to scrub them (see issue #21173).
            self._scrub_removals()
        return len(self.data) - len(self._pending_removals)

    def __repr__(self):
        return "<%s at %#x>" % (self.__class__.__name__, id(self))

    def __setitem__(self, key, value):
        self.data[ref(key, self._remove)] = value

    def copy(self):
        new = WeakKeyDictionary()
        with _IterationGuard(self):
            for key, value in self.data.items():
                o = key()
                if o is not None:
                    new[o] = value
        return new

    __copy__ = copy

    def __deepcopy__(self, memo):
        from copy import deepcopy
        new = self.__class__()
        with _IterationGuard(self):
            for key, value in self.data.items():
                o = key()
                if o is not None:
                    new[o] = deepcopy(value, memo)
        return new

    def get(self, key, default=None):
        return self.data.get(ref(key),default)

    def __contains__(self, key):
        try:
            wr = ref(key)
        except TypeError:
            return False
        return wr in self.data

    def items(self):
        with _IterationGuard(self):
            for wr, value in self.data.items():
                key = wr()
                if key is not None:
                    yield key, value

    def keys(self):
        with _IterationGuard(self):
            for wr in self.data:
                obj = wr()
                if obj is not None:
                    yield obj

    __iter__ = keys

    def values(self):
        with _IterationGuard(self):
            for wr, value in self.data.items():
                if wr() is not None:
                    yield value

    def keyrefs(self):
        """Return a list of weak references to the keys.

        The references are not guaranteed to be 'live' at the time
        they are used, so the result of calling the references needs
        to be checked before being used.  This can be used to avoid
        creating references that will cause the garbage collector to
        keep the keys around longer than needed.

        """
        return list(self.data)

    def popitem(self):
        self._dirty_len = True
        while True:
            key, value = self.data.popitem()
            o = key()
            if o is not None:
                return o, value

    def pop(self, key, *args):
        self._dirty_len = True
        return self.data.pop(ref(key), *args)

    def setdefault(self, key, default=None):
        return self.data.setdefault(ref(key, self._remove),default)

    def update(self, dict=None, /, **kwargs):
        d = self.data
        if dict is not None:
            if not hasattr(dict, "items"):
                dict = type({})(dict)
            for key, value in dict.items():
                d[ref(key, self._remove)] = value
        if len(kwargs):
            self.update(kwargs)

    def __ior__(self, other):
        self.update(other)
        return self

    def __or__(self, other):
        if isinstance(other, _collections_abc.Mapping):
            c = self.copy()
            c.update(other)
            return c
        return NotImplemented

    def __ror__(self, other):
        if isinstance(other, _collections_abc.Mapping):
            c = self.__class__()
            c.update(other)
            c.update(self)
            return c
        return NotImplemented


class finalize:
    """Class for finalization of weakrefable objects

    finalize(obj, func, *args, **kwargs) returns a callable finalizer
    object which will be called when obj is garbage collected. The
    first time the finalizer is called it evaluates func(*arg, **kwargs)
    and returns the result. After this the finalizer is dead, and
    calling it just returns None.

    When the program exits any remaining finalizers for which the
    atexit attribute is true will be run in reverse order of creation.
    By default atexit is true.
    """

    # Finalizer objects don't have any state of their own.  They are
    # just used as keys to lookup _Info objects in the registry.  This
    # ensures that they cannot be part of a ref-cycle.

    __slots__ = ()
    _registry = {}
    _shutdown = False
    _index_iter = itertools.count()
    _dirty = False
    _registered_with_atexit = False

    class _Info:
        __slots__ = ("weakref", "func", "args", "kwargs", "atexit", "index")

    def __init__(self, obj, func, /, *args, **kwargs):
        if not self._registered_with_atexit:
            # We may register the exit function more than once because
            # of a thread race, but that is harmless
            import atexit
            atexit.register(self._exitfunc)
            finalize._registered_with_atexit = True
        info = self._Info()
        info.weakref = ref(obj, self)
        info.func = func
        info.args = args
        info.kwargs = kwargs or None
        info.atexit = True
        info.index = next(self._index_iter)
        self._registry[self] = info
        finalize._dirty = True

    def __call__(self, _=None):
        """If alive then mark as dead and return func(*args, **kwargs);
        otherwise return None"""
        info = self._registry.pop(self, None)
        if info and not self._shutdown:
            return info.func(*info.args, **(info.kwargs or {}))

    def detach(self):
        """If alive then mark as dead and return (obj, func, args, kwargs);
        otherwise return None"""
        info = self._registry.get(self)
        obj = info and info.weakref()
        if obj is not None and self._registry.pop(self, None):
            return (obj, info.func, info.args, info.kwargs or {})

    def peek(self):
        """If alive then return (obj, func, args, kwargs);
        otherwise return None"""
        info = self._registry.get(self)
        obj = info and info.weakref()
        if obj is not None:
            return (obj, info.func, info.args, info.kwargs or {})

    @property
    def alive(self):
        """Whether finalizer is alive"""
        return self in self._registry

    @property
    def atexit(self):
        """Whether finalizer should be called at exit"""
        info = self._registry.get(self)
        return bool(info) and info.atexit

    @atexit.setter
    def atexit(self, value):
        info = self._registry.get(self)
        if info:
            info.atexit = bool(value)

    def __repr__(self):
        info = self._registry.get(self)
        obj = info and info.weakref()
        if obj is None:
            return '<%s object at %#x; dead>' % (type(self).__name__, id(self))
        else:
            return '<%s object at %#x; for %r at %#x>' % \
                (type(self).__name__, id(self), type(obj).__name__, id(obj))

    @classmethod
    def _select_for_exit(cls):
        # Return live finalizers marked for exit, oldest first
        L = [(f,i) for (f,i) in cls._registry.items() if i.atexit]
        L.sort(key=lambda item:item[1].index)
        return [f for (f,i) in L]

    @classmethod
    def _exitfunc(cls):
        # At shutdown invoke finalizers for which atexit is true.
        # This is called once all other non-daemonic threads have been
        # joined.
        reenable_gc = False
        try:
            if cls._registry:
                import gc
                if gc.isenabled():
                    reenable_gc = True
                    gc.disable()
                pending = None
                while True:
                    if pending is None or finalize._dirty:
                        pending = cls._select_for_exit()
                        finalize._dirty = False
                    if not pending:
                        break
                    f = pending.pop()
                    try:
                        # gc is disabled, so (assuming no daemonic
                        # threads) the following is the only line in
                        # this function which might trigger creation
                        # of a new finalizer
                        f()
                    except Exception:
                        sys.excepthook(*sys.exc_info())
                    assert f not in cls._registry
        finally:
            # prevent any more finalizers from executing during shutdown
            finalize._shutdown = True
            if reenable_gc:
                gc.enable()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       #! /usr/bin/python3.13
"""Interfaces for launching and remotely controlling web browsers."""
# Maintained by Georg Brandl.

import os
import shlex
import shutil
import sys
import subprocess
import threading

__all__ = ["Error", "open", "open_new", "open_new_tab", "get", "register"]


class Error(Exception):
    pass


_lock = threading.RLock()
_browsers = {}                  # Dictionary of available browser controllers
_tryorder = None                # Preference order of available browsers
_os_preferred_browser = None    # The preferred browser


def register(name, klass, instance=None, *, preferred=False):
    """Register a browser connector."""
    with _lock:
        if _tryorder is None:
            register_standard_browsers()
        _browsers[name.lower()] = [klass, instance]

        # Preferred browsers go to the front of the list.
        # Need to match to the default browser returned by xdg-settings, which
        # may be of the form e.g. "firefox.desktop".
        if preferred or (_os_preferred_browser and f'{name}.desktop' == _os_preferred_browser):
            _tryorder.insert(0, name)
        else:
            _tryorder.append(name)


def get(using=None):
    """Return a browser launcher instance appropriate for the environment."""
    if _tryorder is None:
        with _lock:
            if _tryorder is None:
                register_standard_browsers()
    if using is not None:
        alternatives = [using]
    else:
        alternatives = _tryorder
    for browser in alternatives:
        if '%s' in browser:
            # User gave us a command line, split it into name and args
            browser = shlex.split(browser)
            if browser[-1] == '&':
                return BackgroundBrowser(browser[:-1])
            else:
                return GenericBrowser(browser)
        else:
            # User gave us a browser name or path.
            try:
                command = _browsers[browser.lower()]
            except KeyError:
                command = _synthesize(browser)
            if command[1] is not None:
                return command[1]
            elif command[0] is not None:
                return command[0]()
    raise Error("could not locate runnable browser")


# Please note: the following definition hides a builtin function.
# It is recommended one does "import webbrowser" and uses webbrowser.open(url)
# instead of "from webbrowser import *".

def open(url, new=0, autoraise=True):
    """Display url using the default browser.

    If possible, open url in a location determined by new.
    - 0: the same browser window (the default).
    - 1: a new browser window.
    - 2: a new browser page ("tab").
    If possible, autoraise raises the window (the default) or not.

    If opening the browser succeeds, return True.
    If there is a problem, return False.
    """
    if _tryorder is None:
        with _lock:
            if _tryorder is None:
                register_standard_browsers()
    for name in _tryorder:
        browser = get(name)
        if browser.open(url, new, autoraise):
            return True
    return False


def open_new(url):
    """Open url in a new window of the default browser.

    If not possible, then open url in the only browser window.
    """
    return open(url, 1)


def open_new_tab(url):
    """Open url in a new page ("tab") of the default browser.

    If not possible, then the behavior becomes equivalent to open_new().
    """
    return open(url, 2)


def _synthesize(browser, *, preferred=False):
    """Attempt to synthesize a controller based on existing controllers.

    This is useful to create a controller when a user specifies a path to
    an entry in the BROWSER environment variable -- we can copy a general
    controller to operate using a specific installation of the desired
    browser in this way.

    If we can't create a controller in this way, or if there is no
    executable for the requested browser, return [None, None].

    """
    cmd = browser.split()[0]
    if not shutil.which(cmd):
        return [None, None]
    name = os.path.basename(cmd)
    try:
        command = _browsers[name.lower()]
    except KeyError:
        return [None, None]
    # now attempt to clone to fit the new name:
    controller = command[1]
    if controller and name.lower() == controller.basename:
        import copy
        controller = copy.copy(controller)
        controller.name = browser
        controller.basename = os.path.basename(browser)
        register(browser, None, instance=controller, preferred=preferred)
        return [None, controller]
    return [None, None]


# General parent classes

class BaseBrowser:
    """Parent class for all browsers. Do not use directly."""

    args = ['%s']

    def __init__(self, name=""):
        self.name = name
        self.basename = name

    def open(self, url, new=0, autoraise=True):
        raise NotImplementedError

    def open_new(self, url):
        return self.open(url, 1)

    def open_new_tab(self, url):
        return self.open(url, 2)


class GenericBrowser(BaseBrowser):
    """Class for all browsers started with a command
       and without remote functionality."""

    def __init__(self, name):
        if isinstance(name, str):
            self.name = name
            self.args = ["%s"]
        else:
            # name should be a list with arguments
            self.name = name[0]
            self.args = name[1:]
        self.basename = os.path.basename(self.name)

    def open(self, url, new=0, autoraise=True):
        sys.audit("webbrowser.open", url)
        cmdline = [self.name] + [arg.replace("%s", url)
                                 for arg in self.args]
        try:
            if sys.platform[:3] == 'win':
                p = subprocess.Popen(cmdline)
            else:
                p = subprocess.Popen(cmdline, close_fds=True)
            return not p.wait()
        except OSError:
            return False


class BackgroundBrowser(GenericBrowser):
    """Class for all browsers which are to be started in the
       background."""

    def open(self, url, new=0, autoraise=True):
        cmdline = [self.name] + [arg.replace("%s", url)
                                 for arg in self.args]
        sys.audit("webbrowser.open", url)
        try:
            if sys.platform[:3] == 'win':
                p = subprocess.Popen(cmdline)
            else:
                p = subprocess.Popen(cmdline, close_fds=True,
                                     start_new_session=True)
            return p.poll() is None
        except OSError:
            return False


class UnixBrowser(BaseBrowser):
    """Parent class for all Unix browsers with remote functionality."""

    raise_opts = None
    background = False
    redirect_stdout = True
    # In remote_args, %s will be replaced with the requested URL.  %action will
    # be replaced depending on the value of 'new' passed to open.
    # remote_action is used for new=0 (open).  If newwin is not None, it is
    # used for new=1 (open_new).  If newtab is not None, it is used for
    # new=3 (open_new_tab).  After both substitutions are made, any empty
    # strings in the transformed remote_args list will be removed.
    remote_args = ['%action', '%s']
    remote_action = None
    remote_action_newwin = None
    remote_action_newtab = None

    def _invoke(self, args, remote, autoraise, url=None):
        raise_opt = []
        if remote and self.raise_opts:
            # use autoraise argument only for remote invocation
            autoraise = int(autoraise)
            opt = self.raise_opts[autoraise]
            if opt:
                raise_opt = [opt]

        cmdline = [self.name] + raise_opt + args

        if remote or self.background:
            inout = subprocess.DEVNULL
        else:
            # for TTY browsers, we need stdin/out
            inout = None
        p = subprocess.Popen(cmdline, close_fds=True, stdin=inout,
                             stdout=(self.redirect_stdout and inout or None),
                             stderr=inout, start_new_session=True)
        if remote:
            # wait at most five seconds. If the subprocess is not finished, the
            # remote invocation has (hopefully) started a new instance.
            try:
                rc = p.wait(5)
                # if remote call failed, open() will try direct invocation
                return not rc
            except subprocess.TimeoutExpired:
                return True
        elif self.background:
            if p.poll() is None:
                return True
            else:
                return False
        else:
            return not p.wait()

    def open(self, url, new=0, autoraise=True):
        sys.audit("webbrowser.open", url)
        if new == 0:
            action = self.remote_action
        elif new == 1:
            action = self.remote_action_newwin
        elif new == 2:
            if self.remote_action_newtab is None:
                action = self.remote_action_newwin
            else:
                action = self.remote_action_newtab
        else:
            raise Error("Bad 'new' parameter to open(); "
                        f"expected 0, 1, or 2, got {new}")

        args = [arg.replace("%s", url).replace("%action", action)
                for arg in self.remote_args]
        args = [arg for arg in args if arg]
        success = self._invoke(args, True, autoraise, url)
        if not success:
            # remote invocation failed, try straight way
            args = [arg.replace("%s", url) for arg in self.args]
            return self._invoke(args, False, False)
        else:
            return True


class Mozilla(UnixBrowser):
    """Launcher class for Mozilla browsers."""

    remote_args = ['%action', '%s']
    remote_action = ""
    remote_action_newwin = "-new-window"
    remote_action_newtab = "-new-tab"
    background = True


class Epiphany(UnixBrowser):
    """Launcher class for Epiphany browser."""

    raise_opts = ["-noraise", ""]
    remote_args = ['%action', '%s']
    remote_action = "-n"
    remote_action_newwin = "-w"
    background = True


class Chrome(UnixBrowser):
    """Launcher class for Google Chrome browser."""

    remote_args = ['%action', '%s']
    remote_action = ""
    remote_action_newwin = "--new-window"
    remote_action_newtab = ""
    background = True


Chromium = Chrome


class Opera(UnixBrowser):
    """Launcher class for Opera browser."""

    remote_args = ['%action', '%s']
    remote_action = ""
    remote_action_newwin = "--new-window"
    remote_action_newtab = ""
    background = True


class Elinks(UnixBrowser):
    """Launcher class for Elinks browsers."""

    remote_args = ['-remote', 'openURL(%s%action)']
    remote_action = ""
    remote_action_newwin = ",new-window"
    remote_action_newtab = ",new-tab"
    background = False

    # elinks doesn't like its stdout to be redirected -
    # it uses redirected stdout as a signal to do -dump
    redirect_stdout = False


class Konqueror(BaseBrowser):
    """Controller for the KDE File Manager (kfm, or Konqueror).

    See the output of ``kfmclient --commands``
    for more information on the Konqueror remote-control interface.
    """

    def open(self, url, new=0, autoraise=True):
        sys.audit("webbrowser.open", url)
        # XXX Currently I know no way to prevent KFM from opening a new win.
        if new == 2:
            action = "newTab"
        else:
            action = "openURL"

        devnull = subprocess.DEVNULL

        try:
            p = subprocess.Popen(["kfmclient", action, url],
                                 close_fds=True, stdin=devnull,
                                 stdout=devnull, stderr=devnull)
        except OSError:
            # fall through to next variant
            pass
        else:
            p.wait()
            # kfmclient's return code unfortunately has no meaning as it seems
            return True

        try:
            p = subprocess.Popen(["konqueror", "--silent", url],
                                 close_fds=True, stdin=devnull,
                                 stdout=devnull, stderr=devnull,
                                 start_new_session=True)
        except OSError:
            # fall through to next variant
            pass
        else:
            if p.poll() is None:
                # Should be running now.
                return True

        try:
            p = subprocess.Popen(["kfm", "-d", url],
                                 close_fds=True, stdin=devnull,
                                 stdout=devnull, stderr=devnull,
                                 start_new_session=True)
        except OSError:
            return False
        else:
            return p.poll() is None


class Edge(UnixBrowser):
    """Launcher class for Microsoft Edge browser."""

    remote_args = ['%action', '%s']
    remote_action = ""
    remote_action_newwin = "--new-window"
    remote_action_newtab = ""
    background = True


#
# Platform support for Unix
#

# These are the right tests because all these Unix browsers require either
# a console terminal or an X display to run.

def register_X_browsers():

    # use xdg-open if around
    if shutil.which("xdg-open"):
        register("xdg-open", None, BackgroundBrowser("xdg-open"))

    # Opens an appropriate browser for the URL scheme according to
    # freedesktop.org settings (GNOME, KDE, XFCE, etc.)
    if shutil.which("gio"):
        register("gio", None, BackgroundBrowser(["gio", "open", "--", "%s"]))

    xdg_desktop = os.getenv("XDG_CURRENT_DESKTOP", "").split(":")

    # The default GNOME3 browser
    if (("GNOME" in xdg_desktop or
         "GNOME_DESKTOP_SESSION_ID" in os.environ) and
            shutil.which("gvfs-open")):
        register("gvfs-open", None, BackgroundBrowser("gvfs-open"))

    # The default KDE browser
    if (("KDE" in xdg_desktop or
         "KDE_FULL_SESSION" in os.environ) and
            shutil.which("kfmclient")):
        register("kfmclient", Konqueror, Konqueror("kfmclient"))

    # Common symbolic link for the default X11 browser
    if shutil.which("x-www-browser"):
        register("x-www-browser", None, BackgroundBrowser("x-www-browser"))

    # The Mozilla browsers
    for browser in ("firefox", "iceweasel", "seamonkey", "mozilla-firefox",
                    "mozilla"):
        if shutil.which(browser):
            register(browser, None, Mozilla(browser))

    # Konqueror/kfm, the KDE browser.
    if shutil.which("kfm"):
        register("kfm", Konqueror, Konqueror("kfm"))
    elif shutil.which("konqueror"):
        register("konqueror", Konqueror, Konqueror("konqueror"))

    # Gnome's Epiphany
    if shutil.which("epiphany"):
        register("epiphany", None, Epiphany("epiphany"))

    # Google Chrome/Chromium browsers
    for browser in ("google-chrome", "chrome", "chromium", "chromium-browser"):
        if shutil.which(browser):
            register(browser, None, Chrome(browser))

    # Opera, quite popular
    if shutil.which("opera"):
        register("opera", None, Opera("opera"))

    if shutil.which("microsoft-edge"):
        register("microsoft-edge", None, Edge("microsoft-edge"))


def register_standard_browsers():
    global _tryorder
    _tryorder = []

    if sys.platform == 'darwin':
        register("MacOSX", None, MacOSXOSAScript('default'))
        register("chrome", None, MacOSXOSAScript('chrome'))
        register("firefox", None, MacOSXOSAScript('firefox'))
        register("safari", None, MacOSXOSAScript('safari'))
        # OS X can use below Unix support (but we prefer using the OS X
        # specific stuff)

    if sys.platform == "ios":
        register("iosbrowser", None, IOSBrowser(), preferred=True)

    if sys.platform == "serenityos":
        # SerenityOS webbrowser, simply called "Browser".
        register("Browser", None, BackgroundBrowser("Browser"))

    if sys.platform[:3] == "win":
        # First try to use the default Windows browser
        register("windows-default", WindowsDefault)

        # Detect some common Windows browsers, fallback to Microsoft Edge
        # location in 64-bit Windows
        edge64 = os.path.join(os.environ.get("PROGRAMFILES(x86)", "C:\\Program Files (x86)"),
                              "Microsoft\\Edge\\Application\\msedge.exe")
        # location in 32-bit Windows
        edge32 = os.path.join(os.environ.get("PROGRAMFILES", "C:\\Program Files"),
                              "Microsoft\\Edge\\Application\\msedge.exe")
        for browser in ("firefox", "seamonkey", "mozilla", "chrome",
                        "opera", edge64, edge32):
            if shutil.which(browser):
                register(browser, None, BackgroundBrowser(browser))
        if shutil.which("MicrosoftEdge.exe"):
            register("microsoft-edge", None, Edge("MicrosoftEdge.exe"))
    else:
        # Prefer X browsers if present
        #
        # NOTE: Do not check for X11 browser on macOS,
        # XQuartz installation sets a DISPLAY environment variable and will
        # autostart when someone tries to access the display. Mac users in
        # general don't need an X11 browser.
        if sys.platform != "darwin" and (os.environ.get("DISPLAY") or os.environ.get("WAYLAND_DISPLAY")):
            try:
                cmd = "xdg-settings get default-web-browser".split()
                raw_result = subprocess.check_output(cmd, stderr=subprocess.DEVNULL)
                result = raw_result.decode().strip()
            except (FileNotFoundError, subprocess.CalledProcessError,
                    PermissionError, NotADirectoryError):
                pass
            else:
                global _os_preferred_browser
                _os_preferred_browser = result

            register_X_browsers()

        # Also try console browsers
        if os.environ.get("TERM"):
            # Common symbolic link for the default text-based browser
            if shutil.which("www-browser"):
                register("www-browser", None, GenericBrowser("www-browser"))
            # The Links/elinks browsers <http://links.twibright.com/>
            if shutil.which("links"):
                register("links", None, GenericBrowser("links"))
            if shutil.which("elinks"):
                register("elinks", None, Elinks("elinks"))
            # The Lynx browser <https://lynx.invisible-island.net/>, <http://lynx.browser.org/>
            if shutil.which("lynx"):
                register("lynx", None, GenericBrowser("lynx"))
            # The w3m browser <http://w3m.sourceforge.net/>
            if shutil.which("w3m"):
                register("w3m", None, GenericBrowser("w3m"))

    # OK, now that we know what the default preference orders for each
    # platform are, allow user to override them with the BROWSER variable.
    if "BROWSER" in os.environ:
        userchoices = os.environ["BROWSER"].split(os.pathsep)
        userchoices.reverse()

        # Treat choices in same way as if passed into get() but do register
        # and prepend to _tryorder
        for cmdline in userchoices:
            if cmdline != '':
                cmd = _synthesize(cmdline, preferred=True)
                if cmd[1] is None:
                    register(cmdline, None, GenericBrowser(cmdline), preferred=True)

    # what to do if _tryorder is now empty?


#
# Platform support for Windows
#

if sys.platform[:3] == "win":
    class WindowsDefault(BaseBrowser):
        def open(self, url, new=0, autoraise=True):
            sys.audit("webbrowser.open", url)
            try:
                os.startfile(url)
            except OSError:
                # [Error 22] No application is associated with the specified
                # file for this operation: '<URL>'
                return False
            else:
                return True

#
# Platform support for macOS
#

if sys.platform == 'darwin':
    class MacOSXOSAScript(BaseBrowser):
        def __init__(self, name='default'):
            super().__init__(name)

        def open(self, url, new=0, autoraise=True):
            sys.audit("webbrowser.open", url)
            url = url.replace('"', '%22')
            if self.name == 'default':
                script = f'open location "{url}"'  # opens in default browser
            else:
                script = f'''
                   tell application "{self.name}"
                       activate
                       open location "{url}"
                   end
                   '''

            osapipe = os.popen("osascript", "w")
            if osapipe is None:
                return False

            osapipe.write(script)
            rc = osapipe.close()
            return not rc

#
# Platform support for iOS
#
if sys.platform == "ios":
    from _ios_support import objc
    if objc:
        # If objc exists, we know ctypes is also importable.
        from ctypes import c_void_p, c_char_p, c_ulong

    class IOSBrowser(BaseBrowser):
        def open(self, url, new=0, autoraise=True):
            sys.audit("webbrowser.open", url)
            # If ctypes isn't available, we can't open a browser
            if objc is None:
                return False

            # All the messages in this call return object references.
            objc.objc_msgSend.restype = c_void_p

            # This is the equivalent of:
            #    NSString url_string =
            #        [NSString stringWithCString:url.encode("utf-8")
            #                           encoding:NSUTF8StringEncoding];
            NSString = objc.objc_getClass(b"NSString")
            constructor = objc.sel_registerName(b"stringWithCString:encoding:")
            objc.objc_msgSend.argtypes = [c_void_p, c_void_p, c_char_p, c_ulong]
            url_string = objc.objc_msgSend(
                NSString,
                constructor,
                url.encode("utf-8"),
                4,  # NSUTF8StringEncoding = 4
            )

            # Create an NSURL object representing the URL
            # This is the equivalent of:
            #   NSURL *nsurl = [NSURL URLWithString:url];
            NSURL = objc.objc_getClass(b"NSURL")
            urlWithString_ = objc.sel_registerName(b"URLWithString:")
            objc.objc_msgSend.argtypes = [c_void_p, c_void_p, c_void_p]
            ns_url = objc.objc_msgSend(NSURL, urlWithString_, url_string)

            # Get the shared UIApplication instance
            # This code is the equivalent of:
            # UIApplication shared_app = [UIApplication sharedApplication]
            UIApplication = objc.objc_getClass(b"UIApplication")
            sharedApplication = objc.sel_registerName(b"sharedApplication")
            objc.objc_msgSend.argtypes = [c_void_p, c_void_p]
            shared_app = objc.objc_msgSend(UIApplication, sharedApplication)

            # Open the URL on the shared application
            # This code is the equivalent of:
            #   [shared_app openURL:ns_url
            #               options:NIL
            #     completionHandler:NIL];
            openURL_ = objc.sel_registerName(b"openURL:options:completionHandler:")
            objc.objc_msgSend.argtypes = [
                c_void_p, c_void_p, c_void_p, c_void_p, c_void_p
            ]
            # Method returns void
            objc.objc_msgSend.restype = None
            objc.objc_msgSend(shared_app, openURL_, ns_url, None, None)

            return True


def parse_args(arg_list: list[str] | None):
    import argparse
    parser = argparse.ArgumentParser(description="Open URL in a web browser.")
    parser.add_argument("url", help="URL to open")

    group = parser.add_mutually_exclusive_group()
    group.add_argument("-n", "--new-window", action="store_const",
                       const=1, default=0, dest="new_win",
                       help="open new window")
    group.add_argument("-t", "--new-tab", action="store_const",
                       const=2, default=0, dest="new_win",
                       help="open new tab")

    args = parser.parse_args(arg_list)

    return args


def main(arg_list: list[str] | None = None):
    args = parse_args(arg_list)

    open(args.url, args.new_win)

    print("\a")


if __name__ == "__main__":
    main()
                                                                                                                                                                                                                                                                                                    Ü   .   ú   ..  Ý   __init__.py Þ   __pycache__ æ   handlers.py ç   
headers.py  è   simple_server.pyé   types.pyê   util.py ë  `validate.py                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             """wsgiref -- a WSGI (PEP 3333) Reference Library

Current Contents:

* util -- Miscellaneous useful functions and wrappers

* headers -- Manage response headers

* handlers -- base classes for server/gateway implementations

* simple_server -- a simple BaseHTTPServer that supports WSGI

* validate -- validation wrapper that sits between an app and a server
  to detect errors in either

* types -- collection of WSGI-related types for static type checking

To-Do:

* cgi_gateway -- Run WSGI apps under CGI (pending a deployment standard)

* cgi_wrapper -- Run CGI apps under WSGI

* router -- a simple middleware component that handles URL traversal
"""
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Þ   .   Ü   ..  ß    __init__.cpython-313.pycà    handlers.cpython-313.pycá    headers.cpython-313.pyc â  ( simple_server.cpython-313.pyc   ã    types.cpython-313.pyc   ä   util.cpython-313.pycå  $validate.cpython-313.pyc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ó
    F\h  ã                   ó    S r g)a  wsgiref -- a WSGI (PEP 3333) Reference Library

Current Contents:

* util -- Miscellaneous useful functions and wrappers

* headers -- Manage response headers

* handlers -- base classes for server/gateway implementations

* simple_server -- a simple BaseHTTPServer that supports WSGI

* validate -- validation wrapper that sits between an app and a server
  to detect errors in either

* types -- collection of WSGI-related types for static type checking

To-Do:

* cgi_gateway -- Run WSGI apps under CGI (pending a deployment standard)

* cgi_wrapper -- Run CGI apps under WSGI

* router -- a simple middleware component that handles URL traversal
N)Ú__doc__© ó    Ú'/usr/lib/python3.13/wsgiref/__init__.pyÚ<module>r      s
   ðòr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ó
    F\h T  ã                   óò    S r SSKJrJrJr  SSKJr  SSKrSSKrSSK	r	/ SQr
/ SQr/ SQrS	 r1 S
kR                  rS rS r " S S5      r " S S\5      r " S S\5      r " S S\5      r " S S\5      rg)z/Base classes for server/gateway implementationsé   )ÚFileWrapperÚguess_schemeÚis_hop_by_hop)ÚHeadersé    N)ÚBaseHandlerÚSimpleHandlerÚBaseCGIHandlerÚ
CGIHandlerÚIISCGIHandlerÚread_environ)ÚMonÚTueÚWedÚThuÚFriÚSatÚSun)NÚJanÚFebÚMarÚAprÚMayÚJunÚJulÚAugÚSepÚOctÚNovÚDecc           	      ój    [         R                  " U 5      u	  pp4pVpxn	S[        U   U[        U   XXV4-  $ )Nz#%s, %02d %3s %4d %02d:%02d:%02d GMT)ÚtimeÚgmtimeÚ_weekdaynameÚ
_monthname)
Ú	timestampÚyearÚmonthÚdayÚhhÚmmÚssÚwdÚyÚzs
             Ú'/usr/lib/python3.13/wsgiref/handlers.pyÚformat_date_timer1      sB    Ü-1¯[ª[¸Ó-CÑ*D" "¨Ø0ÜRÑ#z¨%Ñ0°$¸Bð4ñ ð ó    >
   ÚHTTPSÚ	AUTH_TYPEÚ	PATH_INFOÚREMOTE_USERÚSCRIPT_NAMEÚCONTENT_TYPEÚQUERY_STRINGÚREMOTE_IDENTÚCONTENT_LENGTHÚREQUEST_METHODc                 óÒ    [        U 5      =(       dV    U R                  S5      =(       d>    U R                  S5      =(       d&    U R                  S5      =(       a    [        U SS  5      $ )NÚHTTP_ÚSSL_Ú	REDIRECT_é	   )Ú_is_requestÚ
startswithÚ_needs_transcode)Úks    r0   rD   rD      sT    Üq>÷ CQ\\¨'Ó2÷ C°a·l±lÀ6Ó6J÷ CØLLÓ%×AÔ*:¸1¸Q¸R¸5Ó*AðCr2   c                  ó   [         R                  " 5       n Sn SR                  SU5        0 n[        R
                  R                  5        GH*  u  p4[        U5      (       Ga  [         R                  S:X  aÛ  [        R
                  R                  SS5      R                  5       nUR                  S5      (       a!  UR                  S5      R                  S5      nOUR                  S	5      (       a  OUR                  S
5      (       a'  SU;   a!  UR                  S5      R                  S5      nOBUR                  U S5      R                  S5      nO UR                  X5      R                  S5      nXBU'   GM-     U$ ! [         a    Sn GN`f = f)z'Read environment, fixing HTTP variablesÚsurrogateescapeÚ zutf-8ÚreplaceÚwin32ÚSERVER_SOFTWAREzmicrosoft-iis/ú
iso-8859-1zapache/zsimplehttp/zpython/3)ÚsysÚgetfilesystemencodingÚencodeÚLookupErrorÚosÚenvironÚitemsrD   ÚplatformÚgetÚlowerrC   Údecode)ÚencÚescrR   rE   ÚvÚsoftwares         r0   r   r   "   sW   ä
×
#Ò
#Ó
%CØ
CðØ
		'3Ôð Gô
 

× Ñ ×"ÜA×Òô ||wÓ&Ü::>>Ð*;¸RÓ@×FÑFÓHð ×&Ñ&Ð'7×8Ñ8Ø Ó)×0Ñ0°Ó>Að ×(Ñ(¨×3Ñ3Øð ×'Ñ'¨×6Ñ6Ø" hÓ.à Ó)×0Ñ0°Ó>Að   iÓ0×7Ñ7¸ÓEAð
 HHSÓ&×-Ñ-¨lÓ;à
ñW #ðX Nøôg ó Øðús   E< Å<FÆFc                   ó
   \ rS rSrSrSrSrSrSrSr	Sr
Sr\" 5       r\r\rSrSrS	/rS
rS=rrSrSrSrS rS rS rS rS rS r S&S jr!S r"S r#S r$S r%S r&S r'S r(S r)S r*S r+S r,S r-S r.S  r/S! r0S" r1S# r2S$ r3S%r4g)'r   é^   z+Manage the invocation of a WSGI application)r   r   TFz1.0Nz500 Internal Server Error)zContent-Typez
text/plains;   A server error occurred.  Please contact the administrator.r   c                 ó    U R                  5         U" U R                  U R                  5      U l        U R	                  5         g! [
        [        [        4 a     g   U R                  5          g!   U R                  5         e = f= f)zInvoke the applicationN)
Úsetup_environrR   Ústart_responseÚresultÚfinish_responseÚConnectionAbortedErrorÚBrokenPipeErrorÚConnectionResetErrorÚhandle_errorÚclose)ÚselfÚapplications     r0   ÚrunÚBaseHandler.run   sv    ð	Ø×ÑÔ Ù% d§l¡l°D×4GÑ4GÓHDKØ× Ñ Õ"øÜ&¬Ô9MÐNó 	ñ ð	ðØ×!Ñ!Ö#øðà

Øýs$   AA ÁBÁBÁA0Á0BÂBc                 ó   U R                   R                  5       =ol        U R                  5         U R	                  5       US'   U R                  5       US'   U R                  US'   U R                  US'   U R                  5       US'   U R                  US'   U R                  US'   U R                  b  U R                  US	'   U R                  (       a/  U R                  (       a  UR                  S
U R                  5        ggg)z&Set up the environment for one requestz
wsgi.inputzwsgi.errorszwsgi.versionzwsgi.run_oncezwsgi.url_schemezwsgi.multithreadzwsgi.multiprocessNzwsgi.file_wrapperrK   )Ú
os_environÚcopyrR   Úadd_cgi_varsÚ	get_stdinÚ
get_stderrÚwsgi_versionÚwsgi_run_onceÚ
get_schemeÚwsgi_multithreadÚwsgi_multiprocessÚwsgi_file_wrapperÚorigin_serverÚserver_softwareÚ
setdefault)rh   Úenvs     r0   r_   ÚBaseHandler.setup_environ   sè    ð "__×1Ñ1Ó3Ð3lØ×ÑÔà#'§>¡>Ó#3LÑØ#'§?¡?Ó#4MÑØ#'×#4Ñ#4NÑØ#'×#5Ñ#5OÑØ#'§?¡?Ó#4ÐÑØ#'×#8Ñ#8ÐÑØ#'×#9Ñ#9ÐÑ à×!Ñ!Ñ-Ø'+×'=Ñ'=CÐ#Ñ$à×× $×"6×"6ØNNÐ,¨T×-AÑ-AÕBð #7Ðr2   c                 óX    U R                  5       (       a  U R                  5       (       d4  U R                   H  nU R                  U5        M     U R	                  5         U R                  5         g!   [        U R                  S5      (       a  U R                  R                  5         e = f)a  Send any iterable data, then close self and the iterable

Subclasses intended for use in asynchronous servers will
want to redefine this method, such that it sets up callbacks
in the event loop to iterate over the data, and to call
'self.close()' once the response is finished.
rg   N)Úresult_is_fileÚsendfilera   ÚwriteÚfinish_contentrg   Úhasattr©rh   Údatas     r0   rb   ÚBaseHandler.finish_response­   s~    ð	Ø×&Ñ&×(Ñ(°·±·±Ø KKDØJJtÖ$ñ (à×#Ñ#Ô%ð JJLøð	ô t{{ G×,Ñ,Ø×!Ñ!Ô#Øús   AA1 Á18B)c                 ó,    [        U R                  5      $ )z Return the URL scheme being used)r   rR   ©rh   s    r0   rt   ÚBaseHandler.get_schemeÇ   s    äDLLÓ)Ð)r2   c                 ó¸     [        U R                  5      nUS:X  a#  [        U R                  5      U R                  S'   gg! [
        [        [        4 a     gf = f)z@Compute Content-Length or switch to chunked encoding if possibler   úContent-LengthN)Úlenra   ÚstrÚ
bytes_sentÚheadersÚ	TypeErrorÚAttributeErrorÚNotImplementedError)rh   Úblockss     r0   Úset_content_lengthÚBaseHandler.set_content_lengthÌ   sZ    ð	ÜÓ%Fð qyÜ14°T·_±_Ó1EÐ-Ñ.Øð øô .Ô)<Ð=ó 	Ùð	ús   A ÁAÁAc                 óF    SU R                   ;  a  U R                  5         gg)zaMake any necessary header changes or defaults

Subclasses can extend this to add other defaults.
r   N)r   r   r   s    r0   Úcleanup_headersÚBaseHandler.cleanup_headersÙ   s!    ð
  4§<¡<Ó/Ø×#Ñ#Õ%ð 0r2   c                 ó®   U(       a   U R                   (       a  e  SnOU R                  b  [        S5      eXl        U R	                  U5      U l        U R                  US5      nU R                  U5         U HG  u  pEU R                  US5      nU R                  US5      n[        U5      (       d  M;   SU SU S35       e   U R                  $ ! Snf = f)	z4'start_response()' callable as specified by PEP 3333NzHeaders already set!ÚStatuszHeader namezHeader valuezHop-by-hop header, 'z: z', not allowed)	Úheaders_sentr   ÚAssertionErrorÚstatusÚheaders_classÚ_convert_string_typeÚ_validate_statusr   r   )rh   r   r   Úexc_infoÚnameÚvals         r0   r`   ÚBaseHandler.start_responseá   så    ö ð Ø×$×$Øð %ð  Ø\\Ñ%Ü Ð!7Ó8Ð8àØ×)Ñ)¨'Ó2Ø×*Ñ*¨6°8Ó<Ø×ÑfÔ%àÛ$	Ø×0Ñ0°°}ÓEØ×/Ñ/°°^ÓDÜ(¨×.Ó.ð JØ-¨d¨V°2°c°U¸.ÐIóJÐ.ñ %ð zzÐøð!  ús   C ÃCc                 ó¦    [        U5      S:  a  [        S5      eUS S R                  5       (       d  [        S5      eUS   S:w  a  [        S5      eg )Né   z$Status must be at least 4 charactersé   z(Status message must begin w/3-digit codeÚ z+Status message must have a space after code)r   r   Úisdigit)rh   r   s     r0   r   ÚBaseHandler._validate_statusû   sW    Üv;?Ü Ð!GÓHÐHØbqz×!Ñ!×#Ñ#Ü Ð!KÓLÐLØ!9ÓÜ Ð!NÓOÐOð r2   c                 ór    [        U5      [        L a  U$ [        SR                  U[	        U5      5      5      e)zConvert/check value type.z!{0} must be of type str (got {1}))Útyper   r   ÚformatÚrepr)rh   ÚvalueÚtitles      r0   r   Ú BaseHandler._convert_string_type  s4    ä;#ÒØLÜØ/×6Ñ6°u¼dÀ5»kÓJó
ð 	
r2   c                 óf   U R                   (       aó  U R                  5       (       aÝ  U R                  SU R                  < SU R                  < S3R                  S5      5        SU R                  ;  a?  U R                  S[        [        R                  " 5       5      -  R                  S5      5        U R                  (       a?  SU R                  ;  a.  U R                  SU R                  -  R                  S5      5        g
g
g
g
U R                  S	U R                  -  R                  S5      5        g
)z6Transmit version/status/date/server, via self._write()zHTTP/r§   z
rL   ÚDatez
Date: %s
ÚServerzServer: %s
zStatus: %s
N)
rx   Úclient_is_modernÚ_writeÚhttp_versionr   rO   r   r1   r"   ry   r   s    r0   Úsend_preambleÚBaseHandler.send_preamble  sä    à××Ø×$Ñ$×&Ñ&Ø°×1BÔ1BÀ4Ç;Ä;ÐO×WÑWÐXdÓeÔfØ §¡Ó-ØKKØ'Ô*:¼4¿9º9»;Ó*GÑG×OÑOÐP\Ó]ôð ×'×'¨H¸D¿L¹LÓ,HØKKÐ!1°D×4HÑ4HÑ!H× PÑ PÐQ]Ó ^Õ_ð -IÐ'ð 'ð KKÐ)¨D¯K©KÑ7×?Ñ?ÀÓMÕNr2   c                 óP   [        U5      [        L d   S5       eU R                  (       d  [        S5      eU R                  (       d!  [        U5      U l        U R                  5         OU =R                  [        U5      -  sl        U R                  U5        U R                  5         g)z+'write()' callable as specified by PEP 3333z)write() argument must be a bytes instancezwrite() before start_response()N)
r«   Úbytesr   r   r   r   r   Úsend_headersrµ   Ú_flushr   s     r0   r   ÚBaseHandler.write  s~    ô DzUÒ"ð 	8Ø7ó	8Ð"ð {{Ü Ð!BÓCÐCà×"×"ä! $iDOØ×ÑÕàOOs 4yÑ(Oð 	DÔØr2   c                 ó    g)a«  Platform-specific file transmission

Override this method in subclasses to support platform-specific
file transmission.  It is only called if the application's
return iterable ('self.result') is an instance of
'self.wsgi_file_wrapper'.

This method should return a true value if it was able to actually
transmit the wrapped file-like object using a platform-specific
approach.  It should return a false value if normal iteration
should be used instead.  An exception can be raised to indicate
that transmission was attempted, but failed.

NOTE: this method should call 'self.send_headers()' if
'self.headers_sent' is false and it is going to attempt direct
transmission of the file.
F© r   s    r0   r   ÚBaseHandler.sendfile.  s    ð$ r2   c                 ó    U R                   (       d-  U R                  R                  SS5        U R                  5         gg)z.Ensure headers and content have both been sentr   Ú0N)r   r   rz   r»   r   s    r0   r   ÚBaseHandler.finish_contentC  s1    à× × ð LL×#Ñ#Ð$4°cÔ:Ø×ÑÕàr2   c                 ó"    [        U R                  S5      (       a  U R                  R                  5         S=U l        =U l        =U l        U l        SU l        SU l        g! S=U l        =U l        =U l        U l        SU l        SU l        f = f)ztClose the iterable (if needed) and reset all instance vars

Subclasses may want to also drop the client connection.
rg   Nr   F)r   ra   rg   r   r   rR   r   r   r   s    r0   rg   ÚBaseHandler.closeM  s    ð
	;Üt{{ 7×+Ñ+Ø×!Ñ!Ô#àFJÐJDKÐJ$,ÐJ¨¬°t´|ØDO°U Õ!2øð GKÐJDKÐJ$,ÐJ¨¬°t´|ØDO°U Õ!2ús   5A" Á",Bc                 óè    U R                  5         SU l        U R                  (       a  U R                  5       (       a5  U R	                  5         U R                  [        U R                  5      5        gg)z1Transmit headers to the client, via self._write()TN)r   r   rx   r´   r·   rµ   rº   r   r   s    r0   r»   ÚBaseHandler.send_headersZ  sS    à×ÑÔØ ÔØ×!×! T×%:Ñ%:×%<Ñ%<Ø×ÑÔ ØKKdllÓ+Õ,ð &=r2   c                 ó\    U R                   nUSL=(       a    [        U R                  U5      $ )z@True if 'self.result' is an instance of 'self.wsgi_file_wrapper'N)rw   Ú
isinstancera   )rh   Úwrappers     r0   r~   ÚBaseHandler.result_is_filec  s(    à×(Ñ(ØdÐ"×F¤z°$·+±+¸gÓ'FÐFr2   c                 óB    U R                   S   R                  5       S:g  $ )z,True if client can accept status and headersÚSERVER_PROTOCOLzHTTP/0.9)rR   Úupperr   s    r0   r´   ÚBaseHandler.client_is_moderni  s     à||Ð-Ñ.×4Ñ4Ó6¸*ÑDÐDr2   c                 ó¢     SSK Jn  U R                  5       nU" US   US   US   U R                  U5        UR	                  5         Sng! Snf = f)zqLog the 'exc_info' tuple in the server log

Subclasses may override to retarget the output or change its format.
r   )Úprint_exceptionr   é   N)Ú	tracebackrÑ   rq   Útraceback_limitÚflush)rh   r    rÑ   Ústderrs       r0   Úlog_exceptionÚBaseHandler.log_exceptionn  sR    ð
		Ý1Ø__Ó&FÙØX a[¨(°1©+Ø×$Ñ$ fôð LLNàHøtHús   AA
 Á
Ac                 óæ    U R                  [        R                  " 5       5        U R                  (       d<  U R	                  U R
                  U R                  5      U l        U R                  5         gg)z>Log current error, and send error output to client if possibleN)	r×   rM   r    r   Úerror_outputrR   r`   ra   rb   r   s    r0   rf   ÚBaseHandler.handle_error~  sN    à×Ñ3<<>Ô*Ø× × Ø×+Ñ+¨D¯L©L¸$×:MÑ:MÓNDKØ× Ñ Õ"ð !r2   c                 ó    U" U R                   U R                  SS [        R                  " 5       5        U R                  /$ )a  WSGI mini-app to create error output

By default, this just uses the 'error_status', 'error_headers',
and 'error_body' attributes to generate an output page.  It can
be overridden in a subclass to dynamically generate diagnostics,
choose an appropriate message for the user's preferred language, etc.

Note, however, that it's not recommended from a security perspective to
spit out diagnostics to any old user; ideally, you should have to do
something special to enable diagnostic output, which is why we don't
include any here!
N)Úerror_statusÚerror_headersrM   r    Ú
error_body)rh   rR   r`   s      r0   rÚ   ÚBaseHandler.error_output  s4    ñ 	t×(Ñ(¨×);Ñ);¹AÐ)>¼s¿|º|»~ÔNØÐ Ð r2   c                 ó    [         e)z÷Override in subclass to buffer data for send to client

It's okay if this method actually transmits the data; BaseHandler
just separates write and flush operations for greater efficiency
when the underlying system actually has such a distinction.
©r   r   s     r0   rµ   ÚBaseHandler._write  s
    ô "Ð!r2   c                 ó    [         e)zOverride in subclass to force sending of recent '_write()' calls

It's okay if this method is a no-op (i.e., if '_write()' actually
sends the data.
râ   r   s    r0   r¼   ÚBaseHandler._flush¢  s
    ô "Ð!r2   c                 ó    [         e)z4Override in subclass to return suitable 'wsgi.input'râ   r   s    r0   rp   ÚBaseHandler.get_stdinª  ó    ä!Ð!r2   c                 ó    [         e)z5Override in subclass to return suitable 'wsgi.errors'râ   r   s    r0   rq   ÚBaseHandler.get_stderr®  rè   r2   c                 ó    [         e)z>Override in subclass to insert CGI variables in 'self.environ'râ   r   s    r0   ro   ÚBaseHandler.add_cgi_vars²  rè   r2   )r   rR   r   r   ra   r   ©N)5Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__doc__rr   ru   rv   rs   rx   r¶   ry   r   rm   r   rw   r   r   rÔ   rÝ   rÞ   rß   r   ra   r   r   r   rj   r_   rb   rt   r   r   r`   r   r   r·   r   r   r   rg   r»   r~   r´   r×   rf   rÚ   rµ   r¼   rp   rq   ro   Ú__static_attributes__r¿   r2   r0   r   r   ^   sø    Ù5ð LØÐØÐØMàMØLØOñ
 Jð $ÐØMð OØ.LØ2Ð3MØOJð ÐFVØLØGØJòò0Cò*ò4*ò
	ò&ôò4Pò
òOòò*ò*ò
;ò-òGòEò
ò #ò!ò&"ò"ò"ò"õ"r2   r   c                   óB    \ rS rSrSr SS jrS rS rS rS r	S r
S	rg
)r	   i·  aU  Handler that's just initialized with streams, environment, etc.

This handler subclass is intended for synchronous HTTP/1.0 origin servers,
and handles sending the entire response output, given the correct inputs.

Usage::

    handler = SimpleHandler(
        inp,out,err,env, multithread=False, multiprocess=True
    )
    handler.run(app)c                 óL    Xl         X l        X0l        X@l        XPl        X`l        g rí   )ÚstdinÚstdoutrÖ   Úbase_envru   rv   )rh   rö   r÷   rÖ   rR   ÚmultithreadÚmultiprocesss          r0   Ú__init__ÚSimpleHandler.__init__Ä  s$    ð 
ØØØØ +ÔØ!-Õr2   c                 ó    U R                   $ rí   )rö   r   s    r0   rp   ÚSimpleHandler.get_stdinÎ  s    ØzzÐr2   c                 ó    U R                   $ rí   )rÖ   r   s    r0   rq   ÚSimpleHandler.get_stderrÑ  s    Ø{{Ðr2   c                 óN    U R                   R                  U R                  5        g rí   )rR   Úupdaterø   r   s    r0   ro   ÚSimpleHandler.add_cgi_varsÔ  s    Ø×ÑDMMÕ*r2   c                 óî    U R                   R                  U5      nUb  U[        U5      :X  a  g SSKJn  U" S[
        5        XS  =n(       a)  U R                   R                  U5      nXS  =n(       a  M(  g g )Nr   )Úwarnz9SimpleHandler.stdout.write() should not do partial writes)r÷   r   r   Úwarningsr  ÚDeprecationWarning)rh   r   ra   r  s       r0   rµ   ÚSimpleHandler._write×  sq    Ø×"Ñ" 4Ó(Ø>V¤s¨4£yÓ0ØÝ!ÙÐHÜô	 à7mÐ#dÕ#Ø[[×&Ñ& tÓ,Fð 7mÐ#d×#Ñ#r2   c                 ón    U R                   R                  5         U R                   R                  U l        g rí   )r÷   rÕ   r¼   r   s    r0   r¼   ÚSimpleHandler._flushá  s#    Ø×ÑÔØkk×'Ñ'r2   )r¼   rø   rÖ   rö   r÷   rv   ru   N)TF)rî   rï   rð   rñ   rò   rû   rp   rq   ro   rµ   r¼   ró   r¿   r2   r0   r	   r	   ·  s*    ñ
ð (-ô.òòò+ò-õ(r2   r	   c                   ó    \ rS rSrSrSrSrg)r
   iæ  a¦  CGI-like systems using input/output/error streams and environ mapping

Usage::

    handler = BaseCGIHandler(inp,out,err,env)
    handler.run(app)

This handler class is useful for gateway protocols like ReadyExec and
FastCGI, that have usable input/output/error streams and an environment
mapping.  It's also the base class for CGIHandler, which just uses
sys.stdin, os.environ, and so on.

The constructor also takes keyword arguments 'multithread' and
'multiprocess' (defaulting to 'True' and 'False' respectively) to control
the configuration sent to the application.  It sets 'origin_server' to
False (to enable CGI-like output), and assumes that 'wsgi.run_once' is
False.
Fr¿   N)rî   rï   rð   rñ   rò   rx   ró   r¿   r2   r0   r
   r
   æ  s    ñð& Mr2   r
   c                   ó&    \ rS rSrSrSr0 rS rSrg)r   iþ  aÅ  CGI-based invocation via sys.stdin/stdout/stderr and os.environ

Usage::

    CGIHandler().run(app)

The difference between this class and BaseCGIHandler is that it always
uses 'wsgi.run_once' of 'True', 'wsgi.multithread' of 'False', and
'wsgi.multiprocess' of 'True'.  It does not take any initialization
parameters, but always uses 'sys.stdin', 'os.environ', and friends.

If you need to override any of these parameters, use BaseCGIHandler
instead.
Tc           
      óÂ    [         R                  U [        R                  R                  [        R
                  R                  [        R                  [        5       SSS9  g )NFT©rù   rú   )r
   rû   rM   rö   Úbufferr÷   rÖ   r   r   s    r0   rû   ÚCGIHandler.__init__  s?    Ü×ÑØ#))×"Ñ"¤C§J¡J×$5Ñ$5´s·z±zÜN¨¸Dð 	 ò 	
r2   r¿   N©	rî   rï   rð   rñ   rò   rs   rm   rû   ró   r¿   r2   r0   r   r   þ  s    ñð Mð Jõ
r2   r   c                   ó&    \ rS rSrSrSr0 rS rSrg)r   i  zÿCGI-based invocation with workaround for IIS path bug

This handler should be used in preference to CGIHandler when deploying on
Microsoft IIS without having set the config allowPathInfo option (IIS>=7)
or metabase allowPathInfoForScriptMappings (IIS<7).
Tc           
      óh   [        5       nUR                  SS5      nUR                  SS5      nUS-   R                  US-   5      (       a  U[        U5      S  US'   [        R                  U [        R                  R                  [        R                  R                  [        R                  USSS9  g )Nr5   rH   r7   Ú/FTr  )r   rU   rC   r   r
   rû   rM   rö   r  r÷   rÖ   )rh   rR   ÚpathÚscripts       r0   rû   ÚIISCGIHandler.__init__4  s    ÜØ{{;¨Ó+Ø]¨BÓ/ØH× Ñ  ¨¡×,Ñ,Ø#'¬¨F«¨Ð#5GKÑ Ü×ÑØ#))×"Ñ"¤C§J¡J×$5Ñ$5´s·z±zØ °Tð 	 ò 	
r2   r¿   Nr  r¿   r2   r0   r   r     s    ñð MØJõ 	
r2   r   )rò   Úutilr   r   r   r   r   rM   rQ   r"   Ú__all__r$   r%   r1   Ú__contains__rB   rD   r   r   r	   r
   r   r   r¿   r2   r0   Ú<module>r     s   ðÙ 5ç :Ñ :Ý ç Ó òò Aò8
òò÷ ,ð ò
Cò9÷xV"ñ V"ôr
,(Kô ,(ô^]ô ô0
ô 
ô<!
Nõ !
r2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ó
    F\hn  ã                   óR    S r SSKr\R                  " S5      rSS jr " S S5      rg)zÓManage HTTP Response Headers

Much of this module is red-handedly pilfered from email.message in the stdlib,
so portions are Copyright (C) 2001,2002 Python Software Foundation, and were
written by Barry Warsaw.
é    Nz[ \(\)<>@,;:\\"/\[\]\?=]c                 óÖ    Ube  [        U5      S:  aV  U(       d  [        R                  U5      (       a,  UR                  SS5      R                  SS5      nU < SU< S3$ U < SU< 3$ U $ )zvConvenience function to format and return a key=value pair.

This will quote the value if needed or if quote is true.
r   Ú\z\\Ú"z\"z="Ú=)ÚlenÚ	tspecialsÚsearchÚreplace)ÚparamÚvalueÚquotes      Ú&/usr/lib/python3.13/wsgiref/headers.pyÚ_formatparamr      s_    ð
 ÑS Z¨!^ÞI×$Ñ$ U×+Ñ+ØMM $¨Ó/×7Ñ7¸¸UÓCEÛ %£uÐ-Ð-ã#¢UÐ+Ð+àó    c                   ó    \ rS rSrSrSS jrS rS rS rS r	S	 r
S
 rS rSS jrS rS rS rS rS rS rS rS rSrg)ÚHeadersé   z,Manage a collection of HTTP response headersNc                 ó´    Ub  UO/ n[        U5      [        La  [        S5      eXl         U H'  u  p#U R	                  U5        U R	                  U5        M)     g )Nz+Headers must be a list of name/value tuples)ÚtypeÚlistÚ	TypeErrorÚ_headersÚ_convert_string_type)ÚselfÚheadersÚkÚvs       r   Ú__init__ÚHeaders.__init__   sV    Ø$Ñ0'°bÜ=¤Ò$ÜÐIÓJÐJØØÛØ×)Ñ)¨!Ô,Ø×)Ñ)¨!Ö,ò  r   c                 óp    [        U5      [        L a  U$ [        SR                  [	        U5      5      5      e)zConvert/check value type.z1Header names/values must be of type str (got {0}))r   ÚstrÚAssertionErrorÚformatÚrepr)r   r   s     r   r   ÚHeaders._convert_string_type)   s3    ä;#ÒØLÜð %ß%+¡V¬D°«KÓ%8ó:ð 	:r   c                 ó,    [        U R                  5      $ )z9Return the total number of headers, including duplicates.)r   r   ©r   s    r   Ú__len__ÚHeaders.__len__0   s    ä4==Ó!Ð!r   c                 ó~    X	 U R                   R                  U R                  U5      U R                  U5      45        g)zSet the value of a header.N)r   Úappendr   )r   ÚnameÚvals      r   Ú__setitem__ÚHeaders.__setitem__4   s8    àJØ×ÑØ×&Ñ& tÓ,¨d×.GÑ.GÈÓ.LÐMõ	Or   c                 óÐ    U R                  UR                  5       5      nU R                   Vs/ s H  o"S   R                  5       U:w  d  M  UPM     snU R                  SS& gs  snf )ziDelete all occurrences of a header, if present.

Does *not* raise an exception if the header is missing.
r   N©r   Úlowerr   ©r   r,   Úkvs      r   Ú__delitem__ÚHeaders.__delitem__:   sM    ð
 ×(Ñ(¨¯©«Ó6Ø)-¯ªÓPª 2¸Q¹%¿+¹+»-È4Ñ:OB©ÑPaÑùÒPs   ®A#ÁA#c                 ó$    U R                  U5      $ )a   Get the first header value for 'name'

Return None if the header is missing instead of raising an exception.

Note that if the header appeared multiple times, the first exactly which
occurrence gets returned is undefined.  Use getall() to get all
the values matching a header field name.
©Úget©r   r,   s     r   Ú__getitem__ÚHeaders.__getitem__B   s    ð xx~Ðr   c                 ó(    U R                  U5      SL$ )z/Return true if the message contains the header.Nr8   r:   s     r   Ú__contains__ÚHeaders.__contains__M   s    àxx~ TÐ)Ð)r   c                 óº    U R                  UR                  5       5      nU R                   Vs/ s H   o"S   R                  5       U:X  d  M  US   PM"     sn$ s  snf )aI  Return a list of all the values for the named field.

These will be sorted in the order they appeared in the original header
list or were added to this instance, and may contain duplicates.  Any
fields deleted and re-inserted are always appended to the header list.
If no fields exist with the given name, returns an empty list.
r   é   r1   r3   s      r   Úget_allÚHeaders.get_allR   sK    ð ×(Ñ(¨¯©«Ó6Ø $§¢ÓE¢"°A±·±³ÀÑ1D1¡ÑEÐEùÒEs   ®AÁ	Ac                 ó    U R                  UR                  5       5      nU R                   H  u  p4UR                  5       U:X  d  M  Us  $    U$ )z:Get the first header value for 'name', or return 'default'r1   )r   r,   Údefaultr   r   s        r   r9   ÚHeaders.get^   sA    à×(Ñ(¨¯©«Ó6Ø==CAØwwy$Øñ !ð r   c                 óP    U R                    VVs/ s H  u  pUPM	     snn$ s  snnf )a  Return a list of all the header field names.

These will be sorted in the order they appeared in the original header
list, or were added to this instance, and may contain duplicates.
Any fields deleted and re-inserted are always appended to the header
list.
©r   ©r   r   r   s      r   ÚkeysÚHeaders.keysg   ó"    ð #mmÔ,mdamÒ,Ð,ùÓ,ó   "c                 óP    U R                    VVs/ s H  u  pUPM	     snn$ s  snnf )zùReturn a list of all header values.

These will be sorted in the order they appeared in the original header
list, or were added to this instance, and may contain duplicates.
Any fields deleted and re-inserted are always appended to the header
list.
rH   rI   s      r   ÚvaluesÚHeaders.valuesq   rL   rM   c                 ó     U R                   SS $ )z÷Get all the header fields and values.

These will be sorted in the order they were in the original header
list, or were added to this instance, and may contain duplicates.
Any fields deleted and re-inserted are always appended to the header
list.
NrH   r'   s    r   ÚitemsÚHeaders.items{   s    ð }}QÐÐr   c                 óR    U R                   R                  < SU R                  < S3$ )NÚ(Ú))Ú	__class__Ú__name__r   r'   s    r   Ú__repr__ÚHeaders.__repr__   s    Ø>>×2Ô2°D·M´MÐBÐBr   c                 ót    SR                  U R                   Vs/ s H  nSU-  PM
     snSS/-   5      $ s  snf )zcstr() returns the formatted headers, complete with end line,
suitable for direct HTTP transmission.z
z%s: %sÚ )Újoinr   )r   r4   s     r   Ú__str__ÚHeaders.__str__   s6    ð {{°D·M²MÓB²M¨bH rM±MÑBÀBÀrÀ7ÑJÓKÐKùÒBs   5c                 ó6    [        U 5      R                  S5      $ )Nz
iso-8859-1)r!   Úencoder'   s    r   Ú	__bytes__ÚHeaders.__bytes__   s    Ü4y×Ñ Ó-Ð-r   c                 ó¨    U R                  U5      nUc=  U R                  R                  U R                  U5      U R                  U5      45        U$ U$ )zReturn first matching header value for 'name', or 'value'

If there is no header named 'name', add a new header with name 'name'
and value 'value'.)r9   r   r+   r   )r   r,   r   Úresults       r   Ú
setdefaultÚHeaders.setdefault   sR    ð
 $Ø>ØMM× Ñ  $×";Ñ";¸DÓ"AØ×)Ñ)¨%Ó0ð"2ô 3àLàMr   c           	      óà   / nUb"  U R                  U5      nUR                  U5        UR                  5        Hx  u  pVU R                  U5      nUc#  UR                  UR                  SS5      5        M<  U R                  U5      nUR                  [	        UR                  SS5      U5      5        Mz     U R
                  R                  U R                  U5      SR                  U5      45        g)a  Extended header setting.

_name is the header field to add.  keyword arguments can be used to set
additional parameters for the header field, with underscores converted
to dashes.  Normally the parameter will be added as key="value" unless
value is None, in which case only the key will be added.

Example:

h.add_header('content-disposition', 'attachment', filename='bud.gif')

Note that unlike the corresponding 'email.message' method, this does
*not* handle '(charset, language, value)' tuples: all values must be
strings or None.
NÚ_Ú-z; )r   r+   rR   r
   r   r   r]   )r   Ú_nameÚ_valueÚ_paramsÚpartsr   r   s          r   Ú
add_headerÚHeaders.add_header   sÄ    ð  ØÑØ×.Ñ.¨vÓ6FØLLÔ ØMMODAØ×)Ñ)¨!Ó,AØyØQYY s¨CÓ0Ö1à×-Ñ-¨aÓ0Ø\¨!¯)©)°C¸Ó*=¸qÓAÖBñ $ð 	×Ñd×7Ñ7¸Ó>ÀÇ	Á	È%Ó@PÐQÕRr   rH   )N)rX   Ú
__module__Ú__qualname__Ú__firstlineno__Ú__doc__r   r   r(   r.   r5   r;   r>   rB   r9   rJ   rO   rR   rY   r^   rb   rf   ro   Ú__static_attributes__© r   r   r   r      s`    Ù6ô-ò:ò"òOòQò	ò*ò
	Fôò-ò-ò òCòLò
.òõSr   r   )NrA   )rt   ÚreÚcompiler   r   r   rv   r   r   Ú<module>ry      s1   ðñó 
ØJJÐ2Ó3	ô÷\Sò \Sr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ó
    F\h¼  ã                   ó   S r SSKJrJr  SSKrSSKrSSKJr  SSK	J
r
  Sr/ SQrS\-   r\
" 5       S	-   \R                  R                  5       S   -   r\S
-   \-   r " S S\5      r " S S\5      r " S S\5      rS r\\4S jr\S:X  af  \" SS\5       r\R2                  R5                  5       r\" S\S   S\S   S5        SSKr\R<                  " S5        \R?                  5         SSS5        gg! , (       d  f       g= f)a!  BaseHTTPServer that implements the Python WSGI protocol (PEP 3333)

This is both an example of how WSGI can be implemented, and a basis for running
simple web applications on a local machine, such as might be done when testing
or debugging an application.  It has not been reviewed for security issues,
however, and we strongly recommend that you use a "real" web server for
production use.

For example usage, see the 'if __name__=="__main__"' block at the end of the
module.  See also the BaseHTTPServer module docs for other API information.
é    )ÚBaseHTTPRequestHandlerÚ
HTTPServerN)ÚSimpleHandler)Úpython_implementationz0.2)Ú
WSGIServerÚWSGIRequestHandlerÚdemo_appÚmake_serverúWSGIServer/Ú/Ú c                   ó    \ rS rSr\rS rSrg)ÚServerHandleré   c                 óî     U R                   R                  U R                  R                  SS5      S   U R                  5        [
        R                  " U 5        g ! [
        R                  " U 5        f = f)Nr   é   r   )Úrequest_handlerÚlog_requestÚstatusÚsplitÚ
bytes_sentr   Úclose©Úselfs    Ú,/usr/lib/python3.13/wsgiref/simple_server.pyr   ÚServerHandler.close    sY    ð	&Ø× Ñ ×,Ñ,Ø×!Ñ! # aÓ(¨Ñ+¨T¯_©_ôô ×Ò Õ%øM×Ò Õ%ús   AA ÁA4© N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Úsoftware_versionÚserver_softwarer   Ú__static_attributes__r   ó    r   r   r      s    à&Oõ&r%   r   c                   ó4    \ rS rSrSrSrS rS rS rS r	Sr
g)	r   é*   z7BaseHTTPServer that implements the Python WSGI protocolNc                 óP    [         R                  " U 5        U R                  5         g)z.Override server_bind to store the server name.N)r   Úserver_bindÚsetup_environr   s    r   r)   ÚWSGIServer.server_bind0   s    ä×ÒtÔ$Ø×ÑÕr%   c                 ó    0 =ol         U R                  US'   SUS'   [        U R                  5      US'   SUS'   SUS'   SUS'   g )	NÚSERVER_NAMEzCGI/1.1ÚGATEWAY_INTERFACEÚSERVER_PORTÚ ÚREMOTE_HOSTÚCONTENT_LENGTHÚSCRIPT_NAME)Úbase_environÚserver_nameÚstrÚserver_port)r   Úenvs     r   r*   ÚWSGIServer.setup_environ5   s\    à"$Ð$ÔØ!×-Ñ-MÑØ#,ÐÑ Ü  ×!1Ñ!1Ó2MÑØMÑØ ÐÑØMÒr%   c                 ó    U R                   $ ©N©Úapplicationr   s    r   Úget_appÚWSGIServer.get_app?   s    Ø×ÑÐr%   c                 ó    Xl         g r;   r<   )r   r=   s     r   Úset_appÚWSGIServer.set_appB   s    Ø&Õr%   )r=   r4   )r   r   r    r!   Ú__doc__r=   r)   r*   r>   rA   r$   r   r%   r   r   r   *   s    áAàKòò
 ò õ'r%   r   c                   ó0    \ rS rSrS\-   rS rS rS rSr	g)r   éG   r   c                 ór   U R                   R                  R                  5       nU R                  US'   U R                  US'   U R
                  US'   SU R                  ;   a  U R                  R                  SS5      u  p#OU R                  Sp2[        R                  R                  US5      US'   X1S	'   U R                  S
   US'   U R                  R                  S5      c  U R                  R                  5       US'   OU R                  S   US'   U R                  R                  S5      nU(       a  XAS'   U R                  R                  5        H`  u  pVUR!                  SS5      R#                  5       oVR%                  5       nXQ;   a  M;  SU-   U;   a  USU-   ==   SU-   -  ss'   MY  XaSU-   '   Mb     U$ )NÚSERVER_PROTOCOLÚSERVER_SOFTWAREÚREQUEST_METHODÚ?r   r0   z
iso-8859-1Ú	PATH_INFOÚQUERY_STRINGr   ÚREMOTE_ADDRzcontent-typeÚCONTENT_TYPEzcontent-lengthr2   Ú-Ú_ÚHTTP_Ú,)Úserverr4   ÚcopyÚrequest_versionÚserver_versionÚcommandÚpathr   ÚurllibÚparseÚunquoteÚclient_addressÚheadersÚgetÚget_content_typeÚitemsÚreplaceÚupperÚstrip)r   r8   rX   ÚqueryÚlengthÚkÚvs          r   Úget_environÚWSGIRequestHandler.get_environK   s   Økk×&Ñ&×+Ñ+Ó-Ø!%×!5Ñ!5ÐÑØ!%×!4Ñ!4ÐÑØ $§¡ÐÑØ$))ÓØ¨¨QÓ/JDà 2ä!<<×/Ñ/°°lÓCKÑØ#NÑØ!×0Ñ0°Ñ3MÑà<<×ÑNÓ+Ñ3Ø"&§,¡,×"?Ñ"?Ó"ACÒà"&§,¡,¨~Ñ">CÑà×!Ñ!Ð"2Ó3ÞØ$*Ð Ñ!àLL×&Ñ&Ö(DAØiiCÓ ×&Ñ&Ó(A¯G©G«I¨!ØxÙØqyCÓØGAI # a¡%Ñ'à!"GAIñ )ð 
r%   c                 ó"    [         R                  $ r;   )ÚsysÚstderrr   s    r   Ú
get_stderrÚWSGIRequestHandler.get_stderrl   s    ÜzzÐr%   c                 óÈ   U R                   R                  S5      U l        [        U R                  5      S:  a'  SU l        SU l        SU l        U R                  S5        gU R                  5       (       d  g[        U R                   U R                  U R                  5       U R                  5       SS9nXl        UR                  U R                  R!                  5       5        g)zHandle a single HTTP requesti  i   r0   i  NF)Úmultithread)ÚrfileÚreadlineÚraw_requestlineÚlenÚrequestlinerU   rW   Ú
send_errorÚparse_requestr   Úwfilerm   rh   r   ÚrunrS   r>   )r   Úhandlers     r   ÚhandleÚWSGIRequestHandler.handleo   sµ    ð  $zz×2Ñ2°5Ó9ÔÜt×#Ñ#Ó$ uÓ,Ø!DÔØ#%DÔ ØDLØOOCÔ Øà×!Ñ!×#Ñ#ØäØJJ

 D§O¡OÓ$5°t×7GÑ7GÓ7IØñ
ð #'ÔØDKK×'Ñ'Ó)Õ*r%   )rW   rs   rU   ru   N)
r   r   r    r!   Ú__version__rV   rh   rm   r{   r$   r   r%   r   r   r   G   s    à" [Ñ0NòòBõ+r%   r   c                 ó   SSK Jn  U" 5       n[        SUS9  [        US9  [        U R	                  5       5      nU H  u  pV[        US[        U5      US9  M     U" SS/5        UR                  5       R                  S5      /$ )	Nr   )ÚStringIOzHello world!)ÚfileÚ=z200 OK)zContent-Typeztext/plain; charset=utf-8zutf-8)Úior   ÚprintÚsortedr`   ÚreprÚgetvalueÚencode)ÚenvironÚstart_responser   ÚstdoutÚhrf   rg   s          r   r	   r	      su    ÝÙZFÜ	.vÒ&Ü	vÒÜw}}ÓAÛÜaDG &Ô)ñ á8ÐJÐKÔLØOOÓ×$Ñ$ WÓ-Ð.Ð.r%   c                 ó<    U" X4U5      nUR                  U5        U$ )zACreate a new WSGI server listening on `host` and `port` for `app`)rA   )ÚhostÚportÚappÚserver_classÚhandler_classrS   s         r   r
   r
      s#    ñ 4,¨Ó6FØ
NN3ÔØMr%   Ú__main__r0   i@  zServing HTTP onr   r   z...zhttp://localhost:8000/xyz?abc) rC   Úhttp.serverr   r   rk   Úurllib.parserY   Úwsgiref.handlersr   Úplatformr   r}   Ú__all__rV   Úversionr   Úsys_versionr"   r   r   r   r	   r
   r   ÚhttpdÚsocketÚgetsocknameÚsar   Ú
webbrowserÚopenÚhandle_requestr   r%   r   Ú<module>r¡      s  ðñ
÷ ;Û 
Û Ý *Ý *àÚ
Ið  Ñ,Ù#Ó%¨Ñ+¨c¯k©k×.?Ñ.?Ó.AÀ!Ñ.DÑDØ! CÑ'¨+Ñ5Ð ô
&Mô 
&ô'ô 'ô:;+Ð/ô ;+ò~	/ð #-Ð<Nôð zÓÙ	RxÔ	(¨EØ\\×%Ñ%Ó'ÙÐ  A¡¨°°1±°uÔ=ÛØÐ7Ô8Ø×ÑÔ÷ 
)Ð	(ð ß	(Õ	(ús   ÂAC2Ã2
D                                                      ó
    F\hµ  ã                   ó(   % S r SSKJrJrJr  SSKJr  SSKJrJ	r	J
r
  / SQr\\\   \\4   r\
\S'   \\S   -  r\
\S'    " S	 S
\	5      r\\\4   r\
\S'   \\\/\\   4   r\
\S'    " S S\	5      r " S S\	5      r " S S\	5      r " S S\	5      rg)z+WSGI-related types for static type checkingé    )ÚCallableÚIterableÚIterator)ÚTracebackType)ÚAnyÚProtocolÚ	TypeAlias)ÚStartResponseÚWSGIEnvironmentÚWSGIApplicationÚInputStreamÚErrorStreamÚFileWrapperÚ_ExcInfo)NNNÚ_OptExcInfoc                   óZ    \ rS rSrSr S
S\S\\\\4      S\S-  S\	\
/\4   4S jjrS	rg)r
   é   z0start_response() callable as defined in PEP 3333ÚstatusÚheadersÚexc_infoNÚreturnc                ó    g ©N© )Úselfr   r   r   s       Ú$/usr/lib/python3.13/wsgiref/types.pyÚ__call__ÚStartResponse.__call__   s    ð %(ó    r   ©.)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__doc__ÚstrÚlistÚtupler   r   ÚbytesÚobjectr   Ú__static_attributes__r   r   r   r
   r
      sW    Ù:ð
 (+ñ	(àð(ð eC HoÑ&ð(ð  Ñ$ð	(ð 
5'6/Ñ	"÷(ð (r   r
   r   r   c                   ót    \ rS rSrSrSS\S\4S jjrSS\S\4S jjrSS\S\	\   4S jjr
S\\   4S	 jrS
rg)r   é!   z(WSGI input stream as defined in PEP 3333Úsizer   c                ó    g r   r   ©r   r.   s     r   ÚreadÚInputStream.read#   ó    °r   c                ó    g r   r   r0   s     r   ÚreadlineÚInputStream.readline$   s    °Sr   Úhintc                ó    g r   r   )r   r7   s     r   Ú	readlinesÚInputStream.readlines%   s    ¸Cr   c                 ó    g r   r   ©r   s    r   Ú__iter__ÚInputStream.__iter__&   s    ¨3r   r   Nr    )r!   r"   r#   r$   r%   Úintr)   r1   r5   r'   r9   r   r=   r+   r   r   r   r   r   !   s<    Ù2Ù4Ð4¨%Õ4Ù8SÐ8¨eÕ8Ù?cÐ?¨t°E©{Õ?Ø.( 5/×.r   r   c                   óP    \ rS rSrSrS\4S jrS\S\4S jrS\	\   S\4S jr
S	rg
)r   é(   z(WSGI error stream as defined in PEP 3333r   c                 ó    g r   r   r<   s    r   ÚflushÚErrorStream.flush*   s    sr   Úsc                ó    g r   r   )r   rE   s     r   ÚwriteÚErrorStream.write+   s    ¨#r   Úseqc                ó    g r   r   )r   rI   s     r   Ú
writelinesÚErrorStream.writelines,   s    °sr   r   N)r!   r"   r#   r$   r%   r*   rC   r&   rG   r'   rK   r+   r   r   r   r   r   (   s+    Ù2Ø"vÔ"Ø-sÐ- &Ô-Ø:d 3iÐ:¨v×:r   r   c                   ó*    \ rS rSrSS\S\4S jjrSrg)Ú	_Readableé.   r.   r   c                ó    g r   r   r0   s     r   r1   Ú_Readable.read/   r3   r   r   Nr    )r!   r"   r#   r$   r?   r)   r1   r+   r   r   r   rN   rN   .   s    Ù4Ð4¨%×4Ð4r   rN   c                   ó:    \ rS rSrSr S	S\S\S\\   4S jjr	Sr
g)
r   é2   z(WSGI file wrapper as defined in PEP 3333ÚfileÚ
block_sizer   c                ó    g r   r   )r   rT   rU   s      r   r   ÚFileWrapper.__call__4   s    àr   r   Nr    )r!   r"   r#   r$   r%   rN   r?   r   r)   r   r+   r   r   r   r   r   2   s.    Ù2à14ñØðØ+.ðà	%÷ð r   r   N)r%   Úcollections.abcr   r   r   Útypesr   Útypingr   r   r	   Ú__all__r(   ÚtypeÚBaseExceptionr   Ú__annotations__r   r
   Údictr&   r   r)   r   r   r   rN   r   r   r   r   Ú<module>r`      sÄ   ðÚ 1ç 8Ñ 8Ý ß +Ñ +òð D Ñ/°ÀÐMÑN)Ó NØ! EÐ*:Ñ$;Ñ;YÓ ;ô(Hô (ð " # s (^Ó +Ø% ¸Ð&FØUOð'ñ ó ô/(ô /ô;(ô ;ô5ô 5ô(õ r                                                                                                                                                                                                       ó
    F\hq  ã                   óp    S r SSKr/ SQr " S S5      rS rS rSS jrS	 rS
 r1 SkR                  r
S rg)z$Miscellaneous WSGI-related Utilitiesé    N)ÚFileWrapperÚguess_schemeÚapplication_uriÚrequest_uriÚshift_path_infoÚsetup_testing_defaultsÚis_hop_by_hopc                   ó.    \ rS rSrSrSS jrS rS rSrg)	r   é   z1Wrapper to convert file-like objects to iterablesc                 ób    Xl         X l        [        US5      (       a  UR                  U l        g g )NÚclose)ÚfilelikeÚblksizeÚhasattrr   )Úselfr   r   s      Ú#/usr/lib/python3.13/wsgiref/util.pyÚ__init__ÚFileWrapper.__init__   s)    Ø ØÜ8G×$Ñ$Ø!DJð %ó    c                 ó    U $ ©N© )r   s    r   Ú__iter__ÚFileWrapper.__iter__   s    Ør   c                 ój    U R                   R                  U R                  5      nU(       a  U$ [        er   )r   Úreadr   ÚStopIteration)r   Údatas     r   Ú__next__ÚFileWrapper.__next__   s(    Ø}}×!Ñ! $§,¡,Ó/ÞØKÜÐr   )r   r   r   N)i    )	Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__doc__r   r   r   Ú__static_attributes__r   r   r   r   r      s    Ù;ô(òõr   r   c                 ó0    U R                  S5      S;   a  gg)zMReturn a guess for whether 'wsgi.url_scheme' should be 'http' or 'https'
    ÚHTTPS)ÚyesÚonÚ1ÚhttpsÚhttp)Úget)Úenvirons    r   r   r      s    ð {{7ÓÐ/Ó/Øàr   c                 ó   U S   S-   nSSK Jn  U R                  S5      (       a  XS   -  nO9XS   -  nU S   S:X  a  U S   S	:w  a  US
U S   -   -  nOU S   S:w  a  US
U S   -   -  nX" U R                  S5      =(       d    SSS9-  nU$ )z@Return the application's base URI (no PATH_INFO or QUERY_STRING)úwsgi.url_schemez://r   ©ÚquoteÚ	HTTP_HOSTÚSERVER_NAMEr,   ÚSERVER_PORTÚ443Ú:Ú80ÚSCRIPT_NAMEÚ/Úlatin1)Úencoding)Úurllib.parser3   r.   )r/   Úurlr3   s      r   r   r   %   s³    à
Ð#Ñ
$ UÑ
*CÝ"à{{;×ÑØ{Ñ#Ñ#à}Ñ%Ñ%àÐ$Ñ%¨Ó0Ø}Ñ%¨Ó.ØsW ]Ñ3Ñ3Ñ3øà}Ñ%¨Ó-ØsW ]Ñ3Ñ3Ñ3à5]Ó+×2¨s¸XÑFÑFCØJr   c                 óì    [        U 5      nSSKJn  U" U R                  SS5      SSS9nU R                  S5      (       d  X$S	S
 -  nOX$-  nU(       a!  U R                  S5      (       a  USU S   -   -  nU$ )zBReturn the full request URI, optionally including the query stringr   r2   Ú	PATH_INFOÚ z/;=,r<   )Úsafer=   r:   é   NÚQUERY_STRINGÚ?)r   r>   r3   r.   )r/   Úinclude_queryr?   r3   Ú	path_infos        r   r   r   9   sw    ä
'Ó
"CÝ"Ùgkk +¨bÓ1¸ÈÑRIØ;;}×%Ñ%Ø}ÑàÑÞ ^×4Ñ4ØsW^Ñ,Ñ,Ñ,ØJr   c                 óÞ   U R                  SS5      nU(       d  gUR                  S5      nUSS  Vs/ s H  o3(       d  M  US:w  d  M  UPM     snUSS& US   nUS	 U R                  SS5      n[        R                  " US-   U-   5      nUR	                  S5      (       a  USS nU(       d  UR	                  S5      (       d  US-  nXPS'   SR                  U5      U S'   US:X  a  SnU$ s  snf )	a6  Shift a name from PATH_INFO to SCRIPT_NAME, returning it

If there are no remaining path segments in PATH_INFO, return None.
Note: 'environ' is modified in-place; use a copy if you need to keep
the original PATH_INFO or SCRIPT_NAME.

Note: when PATH_INFO is just a '/', this returns '' and appends a trailing
'/' to SCRIPT_NAME, even though empty path segments are normally ignored,
and SCRIPT_NAME doesn't normally end in a '/'.  This is intentional
behavior, to ensure that an application can tell the difference between
'/x' and '/x/' when traversing to objects.
rA   rB   Nr;   rD   éÿÿÿÿÚ.r:   )r.   ÚsplitÚ	posixpathÚnormpathÚendswithÚjoin)r/   rH   Ú
path_partsÚpÚnameÚscript_names         r   r   r   F   sý    ð K¨Ó+IÞØà Ó%JØ#-¨a°Ñ#3ÓFÒ#3a³q¸QÀ#¹XÑ#3ÑFJqÐØa=DØ1à++m¨BÓ/KÜ×$Ò$ [°¡_°TÑ%9Ó:KØ×ÑC× Ñ Ø! # 2Ð&Þ×,Ñ,¨S×1Ñ1ØsÑà(MÑØ XX jÓ1GKÑð SyØØKùò+ Gs   ³
C*ÁC*Á	C*c                 ó   U R                  SS5        U R                  SS5        U R                  SU S   5        U R                  SS5        SU ;  a*  S	U ;  a$  U R                  SS
5        U R                  S	S5        U R                  SS5        U R                  SS5        U R                  SS5        U R                  SS5        SSKJnJn  U R                  SU" 5       5        U R                  SU" 5       5        U R                  S[	        U 5      5        U S   S:X  a  U R                  SS5        gU S   S:X  a  U R                  SS5        gg)a  Update 'environ' with trivial defaults for testing purposes

This adds various parameters required for WSGI, including HTTP_HOST,
SERVER_NAME, SERVER_PORT, REQUEST_METHOD, SCRIPT_NAME, PATH_INFO,
and all of the wsgi.* variables.  It only supplies default values,
and does not replace any existing settings for these variables.

This routine is intended to make it easier for unit tests of WSGI
servers and applications to set up dummy environments.  It should *not*
be used by actual WSGI servers or applications, since the data is fake!
r5   z	127.0.0.1ÚSERVER_PROTOCOLzHTTP/1.0r4   ÚREQUEST_METHODÚGETr:   rA   rB   r;   zwsgi.version)rD   r   zwsgi.run_oncer   zwsgi.multithreadzwsgi.multiprocess)ÚStringIOÚBytesIOz
wsgi.inputzwsgi.errorsr1   r-   r6   r9   r,   r7   N)Ú
setdefaultÚiorY   rZ   r   )r/   rY   rZ   s      r   r   r   o   s:   ð ×Ñ} [Ô1Ø×ÑÐ(¨Ô4à×Ñ{ 7¨=Ñ#9Ô:Ø×ÑÐ'¨Ô.àGÓ#¨¸7Ó(BØ×Ñ=¨Ô,Ø×Ñ; sÔ+à×Ñ~ uÔ-Ø×Ñ¨Ô*Ø×ÑÐ)¨1Ô-Ø×ÑÐ*¨AÔ.ç$Ø×Ñ|¡W£YÔ/Ø×Ñ}¡h£jÔ1Ø×ÑÐ(¬°gÓ)>Ô?àÐ Ñ! 6Ó)Ø×Ñ=¨$Õ/Ø	Ð"Ñ	# WÓ	,Ø×Ñ=¨%Õ0ð 
-r   >   ÚteÚupgradeÚtrailersÚ
connectionú
keep-aliveútransfer-encodingúproxy-authenticateúproxy-authorizationc                 ó4    [        U R                  5       5      $ )z?Return true if 'header_name' is an HTTP/1.1 "Hop-by-Hop" header)Ú_hoppishÚlower)Úheader_names    r   r	   r	      s    äK×%Ñ%Ó'Ó(Ð(r   )T)r%   rM   Ú__all__r   r   r   r   r   r   Ú__contains__rf   r	   r   r   r   Ú<module>rk      sM   ðÙ *ã ò÷ñ ò$òô(ò'òR$1òP÷ ,ð	 	ó)r                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ó
    F\h¼:  ã                   ó*   S r S/rSSKrSSKrSSKr\R
                  " S5      r\R
                  " S5      r " S S\5      r	S r
S	 rS
 r " S S5      r " S S5      r " S S5      r " S S5      r " S S5      rS rS rS rS rS rS rS rS rg)a&  
Middleware to check for obedience to the WSGI specification.

Some of the things this checks:

* Signature of the application and start_response (including that
  keyword arguments are not used).

* Environment checks:

  - Environment is a dictionary (and not a subclass).

  - That all the required keys are in the environment: REQUEST_METHOD,
    SERVER_NAME, SERVER_PORT, wsgi.version, wsgi.input, wsgi.errors,
    wsgi.multithread, wsgi.multiprocess, wsgi.run_once

  - That HTTP_CONTENT_TYPE and HTTP_CONTENT_LENGTH are not in the
    environment (these headers should appear as CONTENT_LENGTH and
    CONTENT_TYPE).

  - Warns if QUERY_STRING is missing, as the cgi module acts
    unpredictably in that case.

  - That CGI-style variables (that don't contain a .) have
    (non-unicode) string values

  - That wsgi.version is a tuple

  - That wsgi.url_scheme is 'http' or 'https' (@@: is this too
    restrictive?)

  - Warns if the REQUEST_METHOD is not known (@@: probably too
    restrictive).

  - That SCRIPT_NAME and PATH_INFO are empty or start with /

  - That at least one of SCRIPT_NAME or PATH_INFO are set.

  - That CONTENT_LENGTH is a positive integer.

  - That SCRIPT_NAME is not '/' (it should be '', and PATH_INFO should
    be '/').

  - That wsgi.input has the methods read, readline, readlines, and
    __iter__

  - That wsgi.errors has the methods flush, write, writelines

* The status is a string, contains a space, starts with an integer,
  and that integer is in range (> 100).

* That the headers is a list (not a subclass, not another kind of
  sequence).

* That the items of the headers are tuples of strings.

* That there is no 'status' header (that is used in CGI, but not in
  WSGI).

* That the headers don't contain newlines or colons, end in _ or -, or
  contain characters codes below 037.

* That Content-Type is given if there is content (CGI often has a
  default content type, but WSGI does not).

* That no Content-Type is given when there is no content (@@: is this
  too restrictive?)

* That the exc_info argument to start_response is a tuple or None.

* That all calls to the writer are with strings, and no other methods
  on the writer are accessed.

* That wsgi.input is used properly:

  - .read() is called with exactly one argument

  - That it returns a string

  - That readline, readlines, and __iter__ return strings

  - That .close() is not called

  - No other methods are provided

* That wsgi.errors is used properly:

  - .write() and .writelines() is called with a string

  - That .close() is not called, and no other methods are provided.

* The response iterator:

  - That it is not a string (it should be a list of a single string; a
    string will work, but perform horribly).

  - That .__next__() returns a string

  - That the iterator is not iterated over until start_response has
    been called (that can signal either a server or application
    error).

  - That .close() is called (doesn't raise exception, only prints to
    sys.stderr, because we only know it isn't called when the object
    is garbage collected).
Ú	validatoré    Nz^[a-zA-Z][a-zA-Z0-9\-_]*$z[\000-\037]c                   ó    \ rS rSrSrSrg)ÚWSGIWarningéy   z2
Raised in response to WSGI-spec-related warnings
© N)Ú__name__Ú
__module__Ú__qualname__Ú__firstlineno__Ú__doc__Ú__static_attributes__r   ó    Ú'/usr/lib/python3.13/wsgiref/validate.pyr   r   y   s    ôr   r   c                 ó"    U (       d  [        U6 eg ©N)ÚAssertionError)ÚcondÚargss     r   Úassert_r   ~   s    ÞÜdÐ#Ð#ð r   c                 ór    [        U 5      [        L a  U $ [        SR                  U[	        U 5      5      5      e)Nz!{0} must be of type str (got {1}))ÚtypeÚstrr   ÚformatÚrepr)ÚvalueÚtitles     r   Úcheck_string_typer      s6    ÜU|sÒØÜ
Ø+×2Ñ2°5¼$¸u»+ÓFóHð Hr   c                 ó   ^  U 4S jnU$ )a  
When applied between a WSGI server and a WSGI application, this
middleware will check for WSGI compliance on a number of levels.
This middleware does not modify the request or response in any
way, but will raise an AssertionError if anything seems off
(except for a failure to close the application iterator, which
will be printed to stderr -- there's no way to raise an exception
at that point).
c                  óB  >^^ [        [        U 5      S:H  S5        [        U(       + S5        U u  nm[        U5        / mUU4S jn[        US   5      US'   [	        US   5      US'   T" X#5      n[        US L=(       a    US:g  S5        [        U5        [        UT5      $ )	Né   zTwo arguments requiredúNo keyword arguments allowedc                  ó`  > [        [        U 5      S:H  =(       d    [        U 5      S:H  SU < 35        [        U(       + S5        U S   nU S   n[        U 5      S:X  a  U S   nOS n[        U5        [        U5        [	        X#5        [        U5        TR                  S 5        [        T" U 6 5      $ )Nr    é   zInvalid number of arguments: r!   r   é   )r   ÚlenÚcheck_statusÚcheck_headersÚcheck_content_typeÚcheck_exc_infoÚappendÚWriteWrapper)r   ÚkwÚstatusÚheadersÚexc_infoÚstart_responseÚstart_response_starteds        r   Ústart_response_wrapperÚ;validator.<locals>.lint_app.<locals>.start_response_wrapper   s   ø ÜCI N×4¤c¨$£i°1¡nøÚ59Ð;ô>äFÐ:Ô;Ø!WFØ1gGÜ4yA~Ø 7àäÔ Ü'Ô"ÜvÔ/Ü8Ô$à"×)Ñ)¨$Ô/Ü¡°Ð 5Ó6Ð6r   ú
wsgi.inputúwsgi.errorsFz>The application must return an iterator, if only an empty list)r   r%   Úcheck_environÚInputWrapperÚErrorWrapperÚcheck_iteratorÚIteratorWrapper)r   r,   Úenvironr2   Úiteratorr0   r1   Úapplications        @@r   Úlint_appÚvalidator.<locals>.lint_app   s«   ú ÜD	QÐ 8Ô9ÜBÐ6Ô7Ø"&ÑägÔð "$Ðö	7ô& !-¨W°\Ñ-BÓ CÑÜ!-¨g°mÑ.DÓ!EÑáwÓ?Ü Ð$×:¨°UÑ):ØLô	Nô 	xÔ äxÐ)?Ó@Ð@r   r   )r=   r>   s   ` r   r   r      s   ø õ'AðR Or   c                   ó8    \ rS rSrS rS rS rS rS rS r	Sr
g	)
r7   é¿   c                 ó    Xl         g r   ©Úinput)ÚselfÚ
wsgi_inputs     r   Ú__init__ÚInputWrapper.__init__Á   s    Ø
r   c                 ó    [        [        U5      S:H  5        U R                  R                  " U6 n[        [	        U5      [
        L 5        U$ ©Nr$   )r   r%   rD   Úreadr   Úbytes©rE   r   Úvs      r   rK   ÚInputWrapper.readÄ   s:    ÜD	QÔØJJOOTÐ"ÜQ5Ð Ô!Ør   c                 ó    [        [        U5      S:*  5        U R                  R                  " U6 n[        [	        U5      [
        L 5        U$ rJ   )r   r%   rD   Úreadliner   rL   rM   s      r   rQ   ÚInputWrapper.readlineÊ   s<    ÜD	QÔØJJ×Ò Ð&ÜQ5Ð Ô!Ør   c                 óà    [        [        U5      S:*  5        U R                  R                  " U6 n[        [	        U5      [
        L 5        U H  n[        [	        U5      [        L 5        M     U$ rJ   )r   r%   rD   Ú	readlinesr   ÚlistrL   )rE   r   ÚlinesÚlines       r   rT   ÚInputWrapper.readlinesÐ   sW    ÜD	QÔØ

×$Ò$ dÐ+ÜUtÐ#Ô$ÛDÜDJ¤%Ð'Ö(ñ àr   c              #   óv   #    U R                  5       =n(       a  Uv   U R                  5       =n(       a  M  g g 7fr   )rQ   )rE   rW   s     r   Ú__iter__ÚInputWrap